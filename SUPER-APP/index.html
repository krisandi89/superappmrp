<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="id"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;Super App - Engineer&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Tailwind CSS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Google Fonts: Inter --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Font Awesome for Icons --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Flatpickr for Date Pickers --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Chart.js for Data Visualization --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.jsdelivr.net/npm/chart.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>/* Custom Styles */</p>
<p class="p1"><span class="Apple-converted-space">        </span>body {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: 'Inter', sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #f1f5f9; /* slate-100 */</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.card {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 0.75rem; /* rounded-xl */</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.app-tab-button {</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: all 0.3s ease;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-bottom: 4px solid transparent;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #64748b; /* slate-500 */</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.app-tab-button.active {</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #4f46e5; /* indigo-600 */</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-bottom-color: #4f46e5;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-primary { background-color: #4f46e5; color: white; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-primary:hover { background-color: #4338ca; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-primary:disabled { background-color: #a5b4fc; cursor: not-allowed; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-secondary { background-color: #e5e7eb; color: #374151; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-secondary:hover { background-color: #d1d5db; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.app-pane {</p>
<p class="p1"><span class="Apple-converted-space">             </span>display: none;</p>
<p class="p1"><span class="Apple-converted-space">             </span>animation: fadeIn 0.5s ease-in-out;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.app-pane.active {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: block;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>@keyframes fadeIn {</p>
<p class="p1"><span class="Apple-converted-space">            </span>from { opacity: 0; transform: translateY(10px); }</p>
<p class="p1"><span class="Apple-converted-space">            </span>to { opacity: 1; transform: translateY(0); }</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.form-input, .form-select, .form-textarea {</p>
<p class="p1"><span class="Apple-converted-space">            </span>@apply w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>@apply inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>/* Animasi untuk notifikasi */</p>
<p class="p1"><span class="Apple-converted-space">        </span>@keyframes notificationSlideIn {</p>
<p class="p1"><span class="Apple-converted-space">            </span>from { transform: translateX(100%); opacity: 0; }</p>
<p class="p1"><span class="Apple-converted-space">            </span>to { transform: translateX(0); opacity: 1; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>@keyframes notificationSlideOut {</p>
<p class="p1"><span class="Apple-converted-space">            </span>from { transform: translateX(0); opacity: 1; }</p>
<p class="p1"><span class="Apple-converted-space">            </span>to { transform: translateX(100%); opacity: 0; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body class="p-4 sm:p-6 md:p-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Main App Page --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="page-app" class="page active"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;header class="flex flex-wrap items-center justify-between mb-8 gap-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h1 id="app-header-title" class="text-3xl font-bold text-gray-800"&gt;Dasbor Engineer&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;p id="app-header-subtitle" class="mt-1 text-gray-500"&gt;Pilih aplikasi yang ingin Anda gunakan.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/header&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- App Tab Navigation --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="mb-8 bg-white rounded-xl shadow-sm p-2 flex justify-start space-x-2 overflow-x-auto"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button onclick="changeAppTab('ppu')" id="app-tab-ppu" class="app-tab-button active font-semibold py-3 px-6 rounded-lg flex-shrink-0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;i class="fas fa-file-invoice-dollar mr-2"&gt;&lt;/i&gt; PPU</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button onclick="changeAppTab('rekap')" id="app-tab-rekap" class="app-tab-button font-semibold py-3 px-6 rounded-lg flex-shrink-0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;i class="fas fa-chart-pie mr-2"&gt;&lt;/i&gt; Rekapitulasi</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button onclick="changeAppTab('laporan')" id="app-tab-laporan" class="app-tab-button font-semibold py-3 px-6 rounded-lg flex-shrink-0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;i class="fas fa-calendar-day mr-2"&gt;&lt;/i&gt; Laporan Harian</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- App Content Panes --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;main&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="pane-ppu" class="app-pane active"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="pane-rekap" class="app-pane"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="pane-laporan" class="app-pane"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/main&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Modal for confirmations --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0 transition-opacity duration-200"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="bg-white w-full max-w-md rounded-lg shadow-lg p-6 transform transition-all scale-95 opacity-0 duration-200"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h3 id="modal-title" class="text-lg font-bold text-gray-800 mb-4"&gt;&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p id="modal-message" class="text-gray-600 mb-6"&gt;&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="flex justify-end space-x-3"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button id="modal-cancel" class="btn-secondary rounded-lg px-4 py-2"&gt;Batal&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button id="modal-confirm" class="btn-primary rounded-lg px-4 py-2"&gt;OK&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://cdn.jsdelivr.net/npm/flatpickr"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://npmcdn.com/flatpickr/dist/l10n/id.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>// --- GLOBAL SCOPE ---</p>
<p class="p1"><span class="Apple-converted-space">        </span>// TIDAK LAGI MENGGUNAKAN SCRIPT_URL GOOGLE SHEET</p>
<p class="p1"><span class="Apple-converted-space">        </span>const modal = document.getElementById('modal');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const modalContainer = modal.querySelector('div');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const modalTitle = document.getElementById('modal-title');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const modalMessage = document.getElementById('modal-message');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const modalConfirm = document.getElementById('modal-confirm');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const modalCancel = document.getElementById('modal-cancel');</p>
<p class="p1"><span class="Apple-converted-space">        </span>let globalConfirmCallback = null;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let globalHolidays = {};</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// SISTEM NOTIFIKASI DINAMIS</p>
<p class="p1"><span class="Apple-converted-space">        </span>function showNotification(message, type = 'info', duration = 5000) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const types = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>info: { bg: 'bg-blue-500', icon: 'fas fa-info-circle' },</p>
<p class="p1"><span class="Apple-converted-space">                </span>success: { bg: 'bg-green-500', icon: 'fas fa-check-circle' },</p>
<p class="p1"><span class="Apple-converted-space">                </span>warning: { bg: 'bg-yellow-500', icon: 'fas fa-exclamation-triangle' },</p>
<p class="p1"><span class="Apple-converted-space">                </span>error: { bg: 'bg-red-500', icon: 'fas fa-exclamation-circle' }</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const notification = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">            </span>notification.id = 'notification-' + message.replace(/\s+/g, '-').toLowerCase();</p>
<p class="p1"><span class="Apple-converted-space">            </span>notification.className = `fixed right-4 top-4 max-w-sm w-full bg-white shadow-lg rounded-lg overflow-hidden z-50`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>notification.style.animation = 'notificationSlideIn 0.3s ease-out forwards';</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>notification.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="border-l-4 ${types[type].bg} h-full"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;div class="p-4"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="flex items-start"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="flex-shrink-0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;i class="${types[type].icon} text-xl ${types[type].bg.replace('bg-', 'text-')}"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="ml-3 w-0 flex-1"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;p class="text-sm font-medium text-gray-900"&gt;${message}&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;div class="ml-4 flex-shrink-0 flex"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;button class="inline-flex text-gray-400 hover:text-gray-500 focus:outline-none"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;span class="sr-only"&gt;Close&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;i class="fas fa-times"&gt;&lt;/i&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>`;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>document.body.appendChild(notification);</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const timer = setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>hideNotification(notification);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}, duration);</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>notification.querySelector('button').addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>clearTimeout(timer);</p>
<p class="p1"><span class="Apple-converted-space">                </span>hideNotification(notification);</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function hideNotification(notification) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>notification.style.animation = 'notificationSlideOut 0.3s ease-in forwards';</p>
<p class="p1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>notification.remove();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}, 300);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// --- NAVIGATION ---</p>
<p class="p1"><span class="Apple-converted-space">        </span>function changeAppTab(appName) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>['ppu', 'rekap', 'laporan'].forEach(tab =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById(`app-tab-${tab}`)?.classList.remove('active');</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById(`pane-${tab}`)?.classList.remove('active');</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById(`app-tab-${appName}`)?.classList.add('active');</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById(`pane-${appName}`)?.classList.add('active');</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (appName === 'rekap') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (typeof initRekapCharts === 'function') {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>initRekapCharts();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>}, 100);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// --- GLOBAL UTILITIES ---</p>
<p class="p1"><span class="Apple-converted-space">        </span>const formatTextForPreview = (text) =&gt; (text || '-').replace(/\n/g, '&lt;br&gt;');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>const showModal = (title, message, type = 'alert', onConfirm = null) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>modalTitle.textContent = title;</p>
<p class="p1"><span class="Apple-converted-space">            </span>modalMessage.textContent = message;</p>
<p class="p1"><span class="Apple-converted-space">            </span>globalConfirmCallback = onConfirm;</p>
<p class="p1"><span class="Apple-converted-space">            </span>modalCancel.classList.toggle('hidden', type !== 'confirm');</p>
<p class="p1"><span class="Apple-converted-space">            </span>modalConfirm.textContent = type === 'confirm' ? 'Ya, Hapus' : 'OK';</p>
<p class="p1"><span class="Apple-converted-space">            </span>modal.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>modal.classList.remove('opacity-0');</p>
<p class="p1"><span class="Apple-converted-space">                </span>modalContainer.classList.remove('scale-95', 'opacity-0');</p>
<p class="p1"><span class="Apple-converted-space">            </span>}, 10);</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const hideModal = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>modal.classList.add('opacity-0');</p>
<p class="p1"><span class="Apple-converted-space">            </span>modalContainer.classList.add('scale-95', 'opacity-0');</p>
<p class="p1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; modal.classList.add('hidden'), 200);</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>modalConfirm.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (globalConfirmCallback) globalConfirmCallback();</p>
<p class="p1"><span class="Apple-converted-space">            </span>hideModal();</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>modalCancel.addEventListener('click', hideModal);</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>modal.addEventListener('click', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (e.target === modal) hideModal();</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const parseCurrency = (value) =&gt; parseFloat(String(value).replace(/[^\d]/g, '')) || 0;</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const formatToCurrency = (amount) =&gt; new Intl.NumberFormat('id-ID', {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>style: 'currency',<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>currency: 'IDR',<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>minimumFractionDigits: 0<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>}).format(amount);</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const formatForInputCurrency = (amount) =&gt; amount &gt; 0 ? 'Rp ' + new Intl.NumberFormat('id-ID').format(amount) : '';</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const formatDateForReport = (dateString, options = { day: '2-digit', month: 'short', year: 'numeric' }) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!dateString) return '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>const [year, month, day] = dateString.split('-');</p>
<p class="p1"><span class="Apple-converted-space">            </span>return new Date(year, month - 1, day).toLocaleDateString('id-ID', options);</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const formatDateForInput = (dateString) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!dateString || dateString.length !== 10) return '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>const [year, month, day] = dateString.split('-');</p>
<p class="p1"><span class="Apple-converted-space">            </span>return `${day}/${month}/${year}`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const parseDateFromInput = (str) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!str || !/^\d{2}\/\d{2}\/\d{4}$/.test(str)) return null;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const [day, month, year] = str.split('/').map(Number);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const date = new Date(year, month - 1, day);</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (date.getFullYear() !== year || date.getMonth() + 1 !== month || date.getDate() !== day) return null;</p>
<p class="p1"><span class="Apple-converted-space">            </span>return `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>async function fetchHolidays() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (Object.keys(globalHolidays).length &gt; 0) return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const currentYear = new Date().getFullYear();</p>
<p class="p1"><span class="Apple-converted-space">            </span>for (const year of [currentYear - 1, currentYear, currentYear + 1]) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const response = await fetch(`https://date.nager.at/api/v3/PublicHolidays/${year}/ID`);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (!response.ok) continue;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const holidays = await response.json();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>globalHolidays[year] = {};</p>
<p class="p1"><span class="Apple-converted-space">                    </span>holidays.forEach(h =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>globalHolidays[year][h.date] = h.localName;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.error(`Gagal mengambil data hari libur untuk tahun ${year}:`, error);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showNotification(`Gagal memuat data hari libur ${year}.`, 'warning');</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>const isNationalHoliday = (date) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const year = date.getFullYear();</p>
<p class="p1"><span class="Apple-converted-space">            </span>const dateString = date.toISOString().slice(0, 10);</p>
<p class="p1"><span class="Apple-converted-space">            </span>return globalHolidays[year] ? globalHolidays[year][dateString] : null;</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>function getDayCounts(startDate, endDate) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!startDate || !endDate || startDate &gt; endDate) return { workCount: 0, holidayCount: 0, holidayDetails: [] };</p>
<p class="p1"><span class="Apple-converted-space">            </span>let workCount = 0, holidayCount = 0, holidayDetails = [];</p>
<p class="p1"><span class="Apple-converted-space">            </span>let currentDate = new Date(startDate);</p>
<p class="p1"><span class="Apple-converted-space">            </span>while (currentDate &lt;= endDate) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const dayOfWeek = currentDate.getDay();</p>
<p class="p1"><span class="Apple-converted-space">                </span>const holidayName = isNationalHoliday(currentDate);</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (dayOfWeek === 0 || holidayName) { // Minggu atau hari libur</p>
<p class="p1"><span class="Apple-converted-space">                    </span>holidayCount++;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (holidayName) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const dateString = new Date(currentDate.getTime() - (currentDate.getTimezoneOffset() * 60000)).toISOString().slice(0, 10);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>holidayDetails.push({ date: dateString, name: holidayName });</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>workCount++;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>currentDate.setDate(currentDate.getDate() + 1);</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>return { workCount, holidayCount, holidayDetails };</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// --- CONTENT INJECTION &amp; INITIALIZATION ---</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.addEventListener('DOMContentLoaded', async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Inject all HTML first</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('pane-ppu').innerHTML = `&lt;!-- PPU HTML CONTENT --&gt; &lt;div class="max-w-5xl mx-auto"&gt;&lt;header class="text-center mb-8"&gt;&lt;h1 class="text-3xl font-bold text-gray-800"&gt;Aplikasi Pengajuan Pengeluaran Uang (PPU)&lt;/h1&gt;&lt;p class="text-gray-500 mt-1"&gt;Buat dan kelola proposal pengeluaran Anda.&lt;/p&gt;&lt;/header&gt;&lt;div class="card p-6 mb-6"&gt;&lt;h2 class="text-xl font-semibold text-gray-700 mb-4"&gt;Informasi Proyek&lt;/h2&gt;&lt;div class="grid grid-cols-1 md:grid-cols-2 gap-4"&gt;&lt;div&gt;&lt;label for="ppu-project-name" class="block text-sm font-medium text-gray-600 mb-1"&gt;Proyek&lt;/label&gt;&lt;textarea id="ppu-project-name" class="form-textarea" rows="2"&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="ppu-project-location" class="block text-sm font-medium text-gray-600 mb-1"&gt;Lokasi&lt;/label&gt;&lt;textarea id="ppu-project-location" class="form-textarea" rows="2"&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="ppu-project-activity" class="block text-sm font-medium text-gray-600 mb-1"&gt;Kegiatan/Sub-Judul Laporan&lt;/label&gt;&lt;textarea id="ppu-project-activity" class="form-textarea" rows="2"&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="ppu-project-personnel" class="block text-sm font-medium text-gray-600 mb-1"&gt;Nama Personil&lt;/label&gt;&lt;textarea id="ppu-project-personnel" class="form-textarea" rows="2"&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="ppu-project-applicant" class="block text-sm font-medium text-gray-600 mb-1"&gt;Nama Pemohon&lt;/label&gt;&lt;textarea id="ppu-project-applicant" class="form-textarea" rows="2"&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="ppu-project-applicant-location" class="block text-sm font-medium text-gray-600 mb-1"&gt;Lokasi Pemohon&lt;/label&gt;&lt;textarea id="ppu-project-applicant-location" class="form-textarea" rows="2" placeholder="Contoh: Jakarta"&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="ppu-project-date" class="block text-sm font-medium text-gray-600 mb-1"&gt;Tanggal pengeluaran uang&lt;/label&gt;&lt;input type="text" id="ppu-project-date" class="form-input" placeholder="dd/mm/yyyy"&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="ppu-proposal-date" class="block text-sm font-medium text-gray-600 mb-1"&gt;Tanggal Pengajuan&lt;/label&gt;&lt;input type="text" id="ppu-proposal-date" class="form-input" placeholder="dd/mm/yyyy"&gt;&lt;/div&gt;&lt;div class="md:col-span-2"&gt;&lt;label for="ppu-number" class="block text-sm font-medium text-gray-600 mb-1"&gt;Nomor PPU&lt;/label&gt;&lt;div class="flex items-center"&gt;&lt;input type="text" id="ppu-number" class="form-input bg-gray-100" readonly&gt;&lt;button id="ppu-copy-number-btn" class="ml-2 btn btn-secondary px-3" title="Salin Nomor PPU"&gt;&lt;i class="fas fa-copy"&gt;&lt;/i&gt;&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="grid grid-cols-1 gap-6 mb-8"&gt;&lt;div class="card p-5 flex items-center justify-center"&gt;&lt;div class="bg-indigo-100 text-indigo-600 p-4 rounded-full mr-4"&gt;&lt;i class="fas fa-file-invoice-dollar fa-2x"&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class="text-center"&gt;&lt;p class="text-gray-500 text-sm"&gt;Total Pengajuan&lt;/p&gt;&lt;h3 id="ppu-summary-total-proposal" class="text-3xl font-bold text-gray-800"&gt;Rp 0&lt;/h3&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="card p-6 mb-8"&gt;&lt;h2 id="ppu-form-title" class="text-xl font-semibold text-gray-700 mb-4"&gt;Tambah Rincian Pengajuan&lt;/h2&gt;&lt;form id="ppu-expense-form"&gt;&lt;input type="hidden" id="ppu-expense-id"&gt;&lt;div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end"&gt;&lt;div&gt;&lt;label for="ppu-expense-category" class="block text-sm font-medium text-gray-600 mb-1"&gt;1. Pilih Kategori&lt;/label&gt;&lt;select id="ppu-expense-category" class="form-input" required&gt;&lt;option value=""&gt;-- Pilih --&lt;/option&gt;&lt;option value="Uang Supervisi"&gt;Uang Supervisi&lt;/option&gt;&lt;option value="Transportasi"&gt;Transportasi&lt;/option&gt;&lt;option value="Konsumsi"&gt;Konsumsi&lt;/option&gt;&lt;option value="Akomodasi"&gt;Akomodasi&lt;/option&gt;&lt;option value="Komunikasi"&gt;Komunikasi&lt;/option&gt;&lt;option value="Lainnya"&gt;Lainnya&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;&lt;/div&gt;&lt;div id="ppu-standard-inputs" class="hidden mt-4 grid grid-cols-1 lg:grid-cols-3 gap-4 items-end"&gt;&lt;div class="lg:col-span-2"&gt;&lt;label for="ppu-standard-description" id="ppu-standard-description-label" class="block text-sm font-medium text-gray-600 mb-1"&gt;2. Keterangan&lt;/label&gt;&lt;input type="text" id="ppu-standard-description" class="form-input"&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="ppu-standard-amount" class="block text-sm font-medium text-gray-600 mb-1"&gt;3. Jumlah&lt;/label&gt;&lt;input type="text" id="ppu-standard-amount" inputmode="numeric" class="form-input" placeholder="Rp 0"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div id="ppu-supervisi-inputs" class="hidden mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-start"&gt;&lt;div class="md:col-span-2 lg:col-span-1"&gt;&lt;label for="ppu-supervisi-name" class="block text-sm font-medium text-gray-600 mb-1"&gt;2. Nama Supervisi&lt;/label&gt;&lt;input type="text" id="ppu-supervisi-name" class="form-input"&gt;&lt;/div&gt;&lt;div class="md:col-span-2 lg:col-span-3"&gt;&lt;label class="block text-sm font-medium text-gray-600 mb-1"&gt;3. Pilih Periode&lt;/label&gt;&lt;div class="flex items-center space-x-2"&gt;&lt;input type="text" id="ppu-supervisi-start-date" class="form-input" placeholder="dd/mm/yyyy"&gt;&lt;span class="text-gray-500"&gt;s/d&lt;/span&gt;&lt;input type="text" id="ppu-supervisi-end-date" class="form-input" placeholder="dd/mm/yyyy"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="md:col-span-1"&gt;&lt;label for="ppu-supervisi-rate-work" class="block text-sm font-medium text-gray-600 mb-1"&gt;4. Nom. Hari Kerja&lt;/label&gt;&lt;input type="text" id="ppu-supervisi-rate-work" inputmode="numeric" class="form-input" placeholder="Rp 0"&gt;&lt;/div&gt;&lt;div class="md:col-span-1"&gt;&lt;label for="ppu-supervisi-rate-holiday" class="block text-sm font-medium text-gray-600 mb-1"&gt;5. Nom. Hari Libur&lt;/label&gt;&lt;input type="text" id="ppu-supervisi-rate-holiday" inputmode="numeric" class="form-input" placeholder="Rp 0"&gt;&lt;/div&gt;&lt;div class="md:col-span-1"&gt;&lt;label class="block text-sm font-medium text-gray-600 mb-1"&gt;Jml Hari&lt;/label&gt;&lt;div class="flex items-center space-x-2"&gt;&lt;input type="text" id="ppu-supervisi-day-count-work" class="form-input bg-gray-100" readonly placeholder="Kerja"&gt;&lt;input type="text" id="ppu-supervisi-day-count-holiday" class="form-input bg-gray-100" readonly placeholder="Libur"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="md:col-span-1"&gt;&lt;label for="ppu-supervisi-description" class="block text-sm font-medium text-gray-600 mb-1"&gt;6. Ket. Tambahan&lt;/label&gt;&lt;input type="text" id="ppu-supervisi-description" class="form-input" placeholder="(Opsional)"&gt;&lt;/div&gt;&lt;div class="md:col-span-4"&gt;&lt;label for="ppu-supervisi-total-amount" class="block text-sm font-medium text-gray-600 mb-1"&gt;Total Biaya Supervisi&lt;/label&gt;&lt;input type="text" id="ppu-supervisi-total-amount" class="form-input bg-gray-100 font-bold" readonly&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="flex justify-end space-x-2 mt-6"&gt;&lt;button type="submit" id="ppu-add-expense-btn" class="btn btn-primary"&gt;&lt;i class="fas fa-plus mr-2"&gt;&lt;/i&gt;Tambah&lt;/button&gt;&lt;button type="button" id="ppu-cancel-edit-btn" class="btn btn-secondary hidden"&gt;&lt;i class="fas fa-times mr-2"&gt;&lt;/i&gt;Batal&lt;/button&gt;&lt;/div&gt;&lt;/form&gt;&lt;/div&gt;&lt;div class="card p-6"&gt;&lt;div class="flex flex-wrap justify-between items-center gap-4"&gt;&lt;h2 class="text-xl font-semibold text-gray-700"&gt;Rincian Pengajuan&lt;/h2&gt;&lt;div class="flex gap-2"&gt;&lt;button id="ppu-preview-proposal-btn" class="btn btn-secondary"&gt;&lt;i class="fas fa-eye mr-2"&gt;&lt;/i&gt;Preview&lt;/button&gt;&lt;button id="ppu-save-btn" class="btn btn-primary"&gt;&lt;i class="fas fa-save mr-2"&gt;&lt;/i&gt;Simpan&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="overflow-x-auto mt-4"&gt;&lt;table class="w-full text-left"&gt;&lt;thead class="bg-gray-50"&gt;&lt;tr&gt;&lt;th class="p-3 text-sm font-semibold text-gray-600"&gt;Tanggal/Periode&lt;/th&gt;&lt;th class="p-3 text-sm font-semibold text-gray-600"&gt;Keterangan&lt;/th&gt;&lt;th class="p-3 text-sm font-medium text-gray-600"&gt;Kategori&lt;/th&gt;&lt;th class="p-3 text-sm font-semibold text-gray-600 text-right"&gt;Jumlah&lt;/th&gt;&lt;th class="p-3 text-sm font-semibold text-gray-600 text-center"&gt;Aksi&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody id="ppu-expense-table-body"&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p id="ppu-no-data-message" class="text-center text-gray-500 py-8"&gt;Belum ada rincian pengajuan.&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('pane-rekap').innerHTML = `&lt;!-- REKAP HTML CONTENT --&gt; &lt;div class="max-w-5xl mx-auto"&gt;&lt;header class="text-center mb-8"&gt;&lt;h1 class="text-3xl font-bold text-gray-800"&gt;Aplikasi Rekapitulasi Pengeluaran&lt;/h1&gt;&lt;p class="text-gray-500 mt-1"&gt;Catat dan kelola pengeluaran Anda dengan cerdas.&lt;/p&gt;&lt;/header&gt;&lt;div class="card p-6 mb-6"&gt;&lt;h2 class="text-xl font-semibold text-gray-700 mb-4"&gt;Tarik Data dari PPU&lt;/h2&gt;&lt;div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end"&gt; &lt;div class="md:col-span-2"&gt;&lt;label for="rekap-fetch-ppu-number" class="block text-sm font-medium text-gray-600 mb-1"&gt;Masukkan Nomor PPU&lt;/label&gt;&lt;input type="text" id="rekap-fetch-ppu-number" class="form-input" placeholder="Contoh: PPU-20231027-123456"&gt;&lt;/div&gt;&lt;div&gt;&lt;button id="rekap-fetch-ppu-btn" class="btn btn-primary w-full"&gt;&lt;i class="fas fa-download mr-2"&gt;&lt;/i&gt;Tarik Data&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="card p-6 mb-6"&gt;&lt;h2 class="text-xl font-semibold text-gray-700 mb-4"&gt;Informasi Proyek&lt;/h2&gt;&lt;div class="grid grid-cols-1 md:grid-cols-2 gap-4"&gt;&lt;div&gt;&lt;label for="rekap-project-name" class="block text-sm font-medium text-gray-600 mb-1"&gt;Proyek&lt;/label&gt;&lt;textarea id="rekap-project-name" class="form-textarea" rows="2"&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="rekap-project-location" class="block text-sm font-medium text-gray-600 mb-1"&gt;Lokasi&lt;/label&gt;&lt;textarea id="rekap-project-location" class="form-textarea" rows="2"&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="rekap-project-activity" class="block text-sm font-medium text-gray-600 mb-1"&gt;Kegiatan/Sub-Judul Laporan&lt;/label&gt;&lt;textarea id="rekap-project-activity" class="form-textarea" rows="2"&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="rekap-project-personnel" class="block text-sm font-medium text-gray-600 mb-1"&gt;Nama Personil&lt;/label&gt;&lt;textarea id="rekap-project-personnel" class="form-textarea" rows="2"&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="rekap-project-applicant" class="block text-sm font-medium text-gray-600 mb-1"&gt;Nama Pemohon&lt;/label&gt;&lt;textarea id="rekap-project-applicant" class="form-textarea" rows="2"&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="rekap-project-applicant-location" class="block text-sm font-medium text-gray-600 mb-1"&gt;Lokasi Pemohon&lt;/label&gt;&lt;textarea id="rekap-project-applicant-location" class="form-textarea" rows="2" placeholder="Contoh: Jakarta"&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="card p-6 mb-6"&gt;&lt;h2 class="text-xl font-semibold text-gray-700 mb-4"&gt;Sumber Dana&lt;/h2&gt;&lt;div class="grid grid-cols-1 md:grid-cols-3 gap-4"&gt;&lt;div&gt;&lt;label for="rekap-initial-budget" class="block text-sm font-medium text-gray-600 mb-1"&gt;Total Uang Diterima&lt;/label&gt;&lt;input type="text" id="rekap-initial-budget" inputmode="numeric" class="form-input" placeholder="Rp 0"&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="rekap-budget-date" class="block text-sm font-medium text-gray-600 mb-1"&gt;Tanggal Diterima&lt;/label&gt;&lt;input type="text" id="rekap-budget-date" class="form-input" placeholder="dd/mm/yyyy"&gt;&lt;/div&gt;&lt;div class="md:self-end"&gt;&lt;button id="rekap-set-budget-btn" class="btn btn-primary w-full"&gt;&lt;i class="fas fa-save mr-2"&gt;&lt;/i&gt;Atur Budget&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"&gt;&lt;div class="card p-5 flex items-center"&gt;&lt;div class="bg-blue-100 text-blue-600 p-4 rounded-full mr-4"&gt;&lt;i class="fas fa-wallet fa-2x"&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;p class="text-gray-500 text-sm"&gt;Total Budget&lt;/p&gt;&lt;h3 id="rekap-summary-budget" class="text-2xl font-bold text-gray-800"&gt;Rp 0&lt;/h3&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="card p-5 flex items-center"&gt;&lt;div class="bg-red-100 text-red-600 p-4 rounded-full mr-4"&gt;&lt;i class="fas fa-arrow-down-wide-short fa-2x"&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;p class="text-gray-500 text-sm"&gt;Total Pengeluaran&lt;/p&gt;&lt;h3 id="rekap-summary-expenses" class="text-2xl font-bold text-gray-800"&gt;Rp 0&lt;/h3&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="card p-5 flex items-center"&gt;&lt;div class="bg-green-100 text-green-600 p-4 rounded-full mr-4"&gt;&lt;i class="fas fa-coins fa-2x"&gt;&lt;/i&gt;&lt;/div&gt;&lt;div&gt;&lt;p class="text-gray-500 text-sm"&gt;Sisa Budget&lt;/p&gt;&lt;h3 id="rekap-summary-balance" class="text-2xl font-bold text-gray-800"&gt;Rp 0&lt;/h3&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div id="rekap-charts-container" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8 hidden"&gt;&lt;/div&gt;&lt;div class="card p-6 mb-8"&gt;&lt;h2 id="rekap-form-title" class="text-xl font-semibold text-gray-700 mb-4"&gt;Tambah Pengeluaran Baru&lt;/h2&gt;&lt;form id="rekap-expense-form"&gt;&lt;input type="hidden" id="rekap-expense-id"&gt;&lt;div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end"&gt;&lt;div&gt;&lt;label for="rekap-expense-category" class="block text-sm font-medium text-gray-600 mb-1"&gt;1. Pilih Kategori&lt;/label&gt;&lt;select id="rekap-expense-category" class="form-input" required&gt;&lt;option value=""&gt;-- Pilih --&lt;/option&gt;&lt;option value="Uang Supervisi"&gt;Uang Supervisi&lt;/option&gt;&lt;option value="Transportasi"&gt;Transportasi&lt;/option&gt;&lt;option value="Konsumsi"&gt;Konsumsi&lt;/option&gt;&lt;option value="Akomodasi"&gt;Akomodasi&lt;/option&gt;&lt;option value="Komunikasi"&gt;Komunikasi&lt;/option&gt;&lt;option value="Lainnya"&gt;Lainnya&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;&lt;/div&gt;&lt;div id="rekap-standard-inputs" class="hidden mt-4 grid grid-cols-1 lg:grid-cols-4 gap-4 items-end"&gt;&lt;div&gt;&lt;label for="rekap-standard-date" class="block text-sm font-medium text-gray-600 mb-1"&gt;2. Tanggal&lt;/label&gt;&lt;input type="text" id="rekap-standard-date" class="form-input" placeholder="dd/mm/yyyy"&gt;&lt;/div&gt;&lt;div class="lg:col-span-2"&gt;&lt;label for="rekap-standard-description" id="rekap-standard-description-label" class="block text-sm font-medium text-gray-600 mb-1"&gt;3. Keterangan&lt;/label&gt;&lt;input type="text" id="rekap-standard-description" class="form-input"&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="rekap-standard-amount" class="block text-sm font-medium text-gray-600 mb-1"&gt;4. Jumlah&lt;/label&gt;&lt;input type="text" id="rekap-standard-amount" inputmode="numeric" class="form-input" placeholder="Rp 0"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div id="rekap-supervisi-inputs" class="hidden mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-start"&gt;&lt;div class="md:col-span-2 lg:col-span-1"&gt;&lt;label for="rekap-supervisi-name" class="block text-sm font-medium text-gray-600 mb-1"&gt;2. Nama Supervisi&lt;/label&gt;&lt;input type="text" id="rekap-supervisi-name" class="form-input"&gt;&lt;/div&gt;&lt;div class="md:col-span-2 lg:col-span-3"&gt;&lt;label class="block text-sm font-medium text-gray-600 mb-1"&gt;3. Pilih Periode&lt;/label&gt;&lt;div class="flex items-center space-x-2"&gt;&lt;input type="text" id="rekap-supervisi-start-date" class="form-input" placeholder="dd/mm/yyyy"&gt;&lt;span class="text-gray-500"&gt;s/d&lt;/span&gt;&lt;input type="text" id="rekap-supervisi-end-date" class="form-input" placeholder="dd/mm/yyyy"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="md:col-span-1"&gt;&lt;label for="rekap-supervisi-rate-work" class="block text-sm font-medium text-gray-600 mb-1"&gt;4. Nom. Hari Kerja&lt;/label&gt;&lt;input type="text" id="rekap-supervisi-rate-work" inputmode="numeric" class="form-input" placeholder="Rp 0"&gt;&lt;/div&gt;&lt;div class="md:col-span-1"&gt;&lt;label for="rekap-supervisi-rate-holiday" class="block text-sm font-medium text-gray-600 mb-1"&gt;5. Nom. Hari Libur&lt;/label&gt;&lt;input type="text" id="rekap-supervisi-rate-holiday" inputmode="numeric" class="form-input" placeholder="Rp 0"&gt;&lt;/div&gt;&lt;div class="md:col-span-1"&gt;&lt;label class="block text-sm font-medium text-gray-600 mb-1"&gt;Jml Hari&lt;/label&gt;&lt;div class="flex items-center space-x-2"&gt;&lt;input type="text" id="rekap-supervisi-day-count-work" class="form-input bg-gray-100" readonly placeholder="Kerja"&gt;&lt;input type="text" id="rekap-supervisi-day-count-holiday" class="form-input bg-gray-100" readonly placeholder="Libur"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="md:col-span-1"&gt;&lt;label for="rekap-supervisi-description" class="block text-sm font-medium text-gray-600 mb-1"&gt;6. Ket. Tambahan&lt;/label&gt;&lt;input type="text" id="rekap-supervisi-description" class="form-input" placeholder="(Opsional)"&gt;&lt;/div&gt;&lt;div class="md:col-span-4"&gt;&lt;label for="rekap-supervisi-total-amount" class="block text-sm font-medium text-gray-600 mb-1"&gt;Total Biaya Supervisi&lt;/label&gt;&lt;input type="text" id="rekap-supervisi-total-amount" class="form-input bg-gray-100 font-bold" readonly&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="flex justify-end space-x-2 mt-6"&gt;&lt;button type="submit" id="rekap-add-expense-btn" class="btn btn-primary"&gt;&lt;i class="fas fa-plus mr-2"&gt;&lt;/i&gt;Tambah&lt;/button&gt;&lt;button type="button" id="rekap-cancel-edit-btn" class="btn btn-secondary hidden"&gt;&lt;i class="fas fa-times mr-2"&gt;&lt;/i&gt;Batal&lt;/button&gt;&lt;/div&gt;&lt;/form&gt;&lt;/div&gt;&lt;div class="card p-6"&gt;&lt;div class="flex flex-wrap justify-between items-center gap-4"&gt;&lt;h2 class="text-xl font-semibold text-gray-700"&gt;Laporan &amp; Riwayat&lt;/h2&gt;&lt;div class="flex gap-2"&gt;&lt;button id="rekap-preview-report-btn" class="btn btn-secondary"&gt;&lt;i class="fas fa-eye mr-2"&gt;&lt;/i&gt;Preview&lt;/button&gt;&lt;button id="rekap-save-btn" class="btn btn-primary" disabled&gt;&lt;i class="fas fa-save mr-2"&gt;&lt;/i&gt;Simpan&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="overflow-x-auto mt-4"&gt;&lt;table class="w-full text-left"&gt;&lt;thead class="bg-gray-50"&gt;&lt;tr&gt;&lt;th class="p-3 text-sm font-semibold text-gray-600"&gt;Tanggal/Periode&lt;/th&gt;&lt;th class="p-3 text-sm font-semibold text-gray-600"&gt;Keterangan&lt;/th&gt;&lt;th class="p-3 text-sm font-semibold text-gray-600"&gt;Kategori&lt;/th&gt;&lt;th class="p-3 text-sm font-semibold text-gray-600 text-right"&gt;Jumlah&lt;/th&gt;&lt;th class="p-3 text-sm font-semibold text-gray-600 text-center"&gt;Aksi&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody id="rekap-expense-table-body"&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p id="rekap-no-data-message" class="text-center text-gray-500 py-8"&gt;Belum ada data pengeluaran.&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('pane-laporan').innerHTML = `&lt;!-- LAPORAN HARIAN HTML CONTENT --&gt; &lt;div class="max-w-5xl mx-auto"&gt;&lt;div class="text-center mb-10"&gt;&lt;h1 class="text-3xl font-extrabold text-gray-800 mb-2"&gt;Aplikasi Laporan Harian Proyek&lt;/h1&gt;&lt;p class="text-gray-500 text-lg"&gt;Isi form di bawah ini untuk membuat laporan harian.&lt;/p&gt;&lt;/div&gt;&lt;div class="card p-6 md:p-8 mb-6"&gt;&lt;h2 class="text-2xl font-bold text-gray-700 mb-6 border-b-2 pb-3"&gt;Informasi Proyek&lt;/h2&gt;&lt;div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6"&gt;&lt;div&gt;&lt;label for="laporan-reportDate" class="block text-sm font-medium text-gray-700 mb-1"&gt;Tanggal Laporan:&lt;/label&gt;&lt;input type="text" id="laporan-reportDate" class="form-input" placeholder="Pilih Tanggal"&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="laporan-projectId" class="block text-sm font-medium text-gray-700 mb-1"&gt;Nama Proyek:&lt;/label&gt;&lt;input type="text" id="laporan-projectId" class="form-input" placeholder="Contoh: Proyek Pembangunan Gedung A"&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="laporan-projectLocation" class="block text-sm font-medium text-gray-700 mb-1"&gt;Lokasi Proyek:&lt;/label&gt;&lt;input type="text" id="laporan-projectLocation" class="form-input" placeholder="Contoh: Jakarta Selatan"&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="laporan-weather" class="block text-sm font-medium text-gray-700 mb-1"&gt;Cuaca:&lt;/label&gt;&lt;select id="laporan-weather" class="form-input"&gt;&lt;option value="Cerah"&gt;Cerah&lt;/option&gt;&lt;option value="Mendung"&gt;Mendung&lt;/option&gt;&lt;option value="Hujan Ringan"&gt;Hujan Ringan&lt;/option&gt;&lt;option value="Hujan Lebat"&gt;Hujan Lebat&lt;/option&gt;&lt;option value="Berawan"&gt;Berawan&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="laporan-reporterName" class="block text-sm font-medium text-gray-700 mb-1"&gt;Nama Pelapor:&lt;/label&gt;&lt;input type="text" id="laporan-reporterName" class="form-input" placeholder="Contoh: Budi Santoso"&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="laporan-reporterPosition" class="block text-sm font-medium text-gray-700 mb-1"&gt;Jabatan Pelapor:&lt;/label&gt;&lt;input type="text" id="laporan-reporterPosition" class="form-input" placeholder="Contoh: Site Engineer"&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="laporan-approverName" class="block text-sm font-medium text-gray-700 mb-1"&gt;Diketahui Oleh:&lt;/label&gt;&lt;input type="text" id="laporan-approverName" class="form-input" placeholder="Contoh: Rahmat Hidayat"&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="laporan-approverPosition" class="block text-sm font-medium text-gray-700 mb-1"&gt;Jabatan (Diketahui Oleh):&lt;/label&gt;&lt;input type="text" id="laporan-approverPosition" class="form-input" placeholder="Contoh: Project Manager"&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="card p-6 md:p-8 mb-6"&gt;&lt;h2 class="text-2xl font-bold text-gray-700 mb-6 border-b-2 pb-3"&gt;Detail Kegiatan&lt;/h2&gt;&lt;div class="space-y-6"&gt;&lt;div&gt;&lt;label for="laporan-mainActivities" class="block text-sm font-medium text-gray-700 mb-1"&gt;Kegiatan Utama Hari Ini:&lt;/label&gt;&lt;textarea id="laporan-mainActivities" rows="5" class="form-textarea" placeholder="Masukkan poin-poin kegiatan harian"&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="laporan-issuesConstraints" class="block text-sm font-medium text-gray-700 mb-1"&gt;Masalah/Kendala di Lapangan:&lt;/label&gt;&lt;textarea id="laporan-issuesConstraints" rows="4" class="form-textarea" placeholder="Masukkan kendala atau masalah yang dihadapi"&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;div&gt;&lt;label for="laporan-nextDayPlan" class="block text-sm font-medium text-gray-700 mb-1"&gt;Rencana Kerja Esok Hari:&lt;/label&gt;&lt;textarea id="laporan-nextDayPlan" rows="4" class="form-textarea" placeholder="Masukkan rencana kerja untuk besok"&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="card p-6 md:p-8 mb-6"&gt;&lt;h2 class="text-2xl font-bold text-gray-700 mb-6 border-b-2 pb-3"&gt;Dokumentasi Foto (Maks. 3)&lt;/h2&gt;&lt;div id="laporan-photoUploadArea" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="flex justify-center mt-8 gap-4"&gt;&lt;button onclick="laporan_openPreview()" class="btn btn-secondary"&gt;&lt;i class="fas fa-eye mr-2"&gt;&lt;/i&gt; Preview&lt;/button&gt;&lt;button id="laporan-save-btn" class="btn btn-primary" disabled&gt;&lt;i class="fas fa-save mr-2"&gt;&lt;/i&gt; Simpan&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;`;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>await fetchHolidays();</p>
<p class="p1"><span class="Apple-converted-space">            </span>initPPUApp();</p>
<p class="p1"><span class="Apple-converted-space">            </span>initRekapApp();</p>
<p class="p1"><span class="Apple-converted-space">            </span>initLaporanApp();</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// --- PPU APP SCRIPT ---</p>
<p class="p1"><span class="Apple-converted-space">        </span>function initPPUApp() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const prefix = 'ppu-';</p>
<p class="p1"><span class="Apple-converted-space">            </span>const DOMElements = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>saveBtn: document.getElementById(`${prefix}save-btn`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>projectInfoFields: { name: document.getElementById(`${prefix}project-name`), location: document.getElementById(`${prefix}project-location`), personnel: document.getElementById(`${prefix}project-personnel`), activity: document.getElementById(`${prefix}project-activity`), applicant: document.getElementById(`${prefix}project-applicant`), applicantLocation: document.getElementById(`${prefix}project-applicant-location`), projectDate: document.getElementById(`${prefix}project-date`), proposalDate: document.getElementById(`${prefix}proposal-date`), ppuNumber: document.getElementById(`${prefix}number`) },</p>
<p class="p1"><span class="Apple-converted-space">                </span>copyNumberBtn: document.getElementById(`${prefix}copy-number-btn`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>summaryTotalProposal: document.getElementById(`${prefix}summary-total-proposal`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>expenseForm: document.getElementById(`${prefix}expense-form`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>formTitle: document.getElementById(`${prefix}form-title`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>expenseIdInput: document.getElementById(`${prefix}expense-id`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>expenseCategoryInput: document.getElementById(`${prefix}expense-category`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>addExpenseBtn: document.getElementById(`${prefix}add-expense-btn`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>cancelEditBtn: document.getElementById(`${prefix}cancel-edit-btn`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>expenseTableBody: document.getElementById(`${prefix}expense-table-body`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>noDataMessage: document.getElementById(`${prefix}no-data-message`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>previewProposalBtn: document.getElementById(`${prefix}preview-proposal-btn`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>standardInputs: document.getElementById(`${prefix}standard-inputs`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiInputs: document.getElementById(`${prefix}supervisi-inputs`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>standardDescription: document.getElementById(`${prefix}standard-description`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>standardDescriptionLabel: document.getElementById(`${prefix}standard-description-label`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>standardAmount: document.getElementById(`${prefix}standard-amount`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiName: document.getElementById(`${prefix}supervisi-name`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiStartDate: document.getElementById(`${prefix}supervisi-start-date`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiEndDate: document.getElementById(`${prefix}supervisi-end-date`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiRateWork: document.getElementById(`${prefix}supervisi-rate-work`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiRateHoliday: document.getElementById(`${prefix}supervisi-rate-holiday`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiDayCountWork: document.getElementById(`${prefix}supervisi-day-count-work`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiDayCountHoliday: document.getElementById(`${prefix}supervisi-day-count-holiday`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiDescription: document.getElementById(`${prefix}supervisi-description`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiTotalAmount: document.getElementById(`${prefix}supervisi-total-amount`)</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>let state = { projectInfo: {}, expenses: [] };</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const generatePPUNumber = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const now = new Date();</p>
<p class="p1"><span class="Apple-converted-space">                </span>const year = now.getFullYear();</p>
<p class="p1"><span class="Apple-converted-space">                </span>const month = String(now.getMonth() + 1).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const day = String(now.getDate()).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const hours = String(now.getHours()).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const minutes = String(now.getMinutes()).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const seconds = String(now.getSeconds()).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">                </span>return `PPU-${year}${month}${day}-${hours}${minutes}${seconds}`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// FUNGSI BARU: Menyimpan data ke Vercel</p>
<p class="p1"><span class="Apple-converted-space">            </span>const saveDataToVercel = async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>showNotification('Menyimpan data PPU...', 'info');</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!state.projectInfo.ppuNumber) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>state.projectInfo.ppuNumber = DOMElements.projectInfoFields.ppuNumber.value;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const originalBtnHtml = DOMElements.saveBtn.innerHTML;</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.saveBtn.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.saveBtn.innerHTML = `&lt;i class="fas fa-spinner fa-spin mr-2"&gt;&lt;/i&gt;Menyimpan...`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const response = await fetch('/api/simpanPPU', {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>method: 'POST',</p>
<p class="p1"><span class="Apple-converted-space">                        </span>headers: { 'Content-Type': 'application/json' },</p>
<p class="p1"><span class="Apple-converted-space">                        </span>body: JSON.stringify({ data: state })</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>const result = await response.json();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (response.ok &amp;&amp; result.success) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>showNotification('Data PPU berhasil disimpan!', 'success');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>throw new Error(result.message || 'Gagal menyimpan data.');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>} catch (e) {<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.error("Error saving PPU to Vercel: ", e);<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>showNotification(e.message, 'error');</p>
<p class="p1"><span class="Apple-converted-space">                </span>} finally {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.saveBtn.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.saveBtn.innerHTML = originalBtnHtml;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.saveBtn.addEventListener('click', saveDataToVercel);</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.copyNumberBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const ppuNumberInput = DOMElements.projectInfoFields.ppuNumber;</p>
<p class="p1"><span class="Apple-converted-space">                </span>ppuNumberInput.select();</p>
<p class="p1"><span class="Apple-converted-space">                </span>ppuNumberInput.setSelectionRange(0, 99999);</p>
<p class="p1"><span class="Apple-converted-space">                </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.execCommand('copy');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showNotification('Nomor PPU berhasil disalin!', 'success');</p>
<p class="p1"><span class="Apple-converted-space">                </span>} catch (err) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showNotification('Gagal menyalin nomor.', 'error');</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>window.getSelection().removeAllRanges();</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const calculateSupervisiTotal = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const startDateStr = parseDateFromInput(DOMElements.supervisiStartDate.value);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const endDateStr = parseDateFromInput(DOMElements.supervisiEndDate.value);</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!startDateStr || !endDateStr) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiDayCountWork.value = `0 hr kerja`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiDayCountHoliday.value = `0 hr libur`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiTotalAmount.value = '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>const startDate = new Date(`${startDateStr}T00:00:00`);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const endDate = new Date(`${endDateStr}T00:00:00`);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const { workCount, holidayCount } = getDayCounts(startDate, endDate);</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.supervisiDayCountWork.value = `${workCount} hr kerja`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.supervisiDayCountHoliday.value = `${holidayCount} hr libur`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const rateWork = parseCurrency(DOMElements.supervisiRateWork.value);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const rateHoliday = parseCurrency(DOMElements.supervisiRateHoliday.value);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const total = (workCount * rateWork) + (holidayCount * rateHoliday);</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.supervisiTotalAmount.value = formatForInputCurrency(total);</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const renderTotalProposal = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const total = state.expenses.reduce((sum, exp) =&gt; sum + exp.amount, 0);</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.summaryTotalProposal.textContent = formatToCurrency(total);</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const renderTable = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.expenseTableBody.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">                </span>const hasExpenses = state.expenses.length &gt; 0;</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.noDataMessage.style.display = hasExpenses ? 'none' : 'table-row';</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (hasExpenses) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>[...state.expenses].sort((a, b) =&gt; new Date(b.date) - new Date(a.date)).forEach(exp =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const row = DOMElements.expenseTableBody.insertRow();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>row.className = 'border-b border-gray-200 hover:bg-gray-50';</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const dateCell = row.insertCell();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>dateCell.className = 'p-3 align-top';</p>
<p class="p1"><span class="Apple-converted-space">                        </span>dateCell.textContent = exp.isPeriod ? `${formatDateForReport(exp.date)} - ${formatDateForReport(exp.endDate)}` : formatDateForReport(exp.date);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const descCell = row.insertCell();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>descCell.className = 'p-3 align-top';</p>
<p class="p1"><span class="Apple-converted-space">                        </span>let descriptionHtml = exp.description;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (exp.category === 'Uang Supervisi' &amp;&amp; exp.details?.holidayDetails?.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>const holidayList = exp.details.holidayDetails.map(h =&gt; `&lt;li&gt;${formatDateForReport(h.date, {day: 'numeric', month: 'short'})}: ${h.name}&lt;/li&gt;`).join('');</p>
<p class="p1"><span class="Apple-converted-space">                            </span>descriptionHtml += `&lt;ul class="text-xs text-gray-500 mt-1 pl-4 list-disc"&gt;Ket. Libur:${holidayList}&lt;/ul&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>descCell.innerHTML = descriptionHtml;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>row.insertCell().innerHTML = `&lt;span class="px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800 whitespace-nowrap"&gt;${exp.category}&lt;/span&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>row.insertCell().textContent = formatToCurrency(exp.amount);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>row.cells[3].className = 'p-3 align-top text-right font-semibold';</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const actionCell = row.insertCell();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>actionCell.className = 'p-3 align-top text-center';</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const actionId = exp.groupId || exp.id;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>actionCell.innerHTML = `&lt;button onclick="window.ppu_handleEdit('${actionId}')" class="text-blue-500 hover:text-blue-700 mr-2" title="Edit"&gt;&lt;i class="fas fa-pencil-alt"&gt;&lt;/i&gt;&lt;/button&gt;&lt;button onclick="window.ppu_handleDelete('${actionId}')" class="text-red-500 hover:text-red-700" title="Hapus"&gt;&lt;i class="fas fa-trash-alt"&gt;&lt;/i&gt;&lt;/button&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const renderProjectInfo = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>for (const key in DOMElements.projectInfoFields) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const field = DOMElements.projectInfoFields[key];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if(field) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (key === 'projectDate' || key === 'proposalDate') {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>field.value = formatDateForInput(state.projectInfo[key]);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>field.value = state.projectInfo[key] || '';</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const renderAll = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>renderProjectInfo();</p>
<p class="p1"><span class="Apple-converted-space">                </span>renderTotalProposal();</p>
<p class="p1"><span class="Apple-converted-space">                </span>renderTable();</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const updateFormUI = (category) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.standardInputs.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.supervisiInputs.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.standardDescriptionLabel.textContent = '2. Keterangan';</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.standardDescription.placeholder = 'Detail pengeluaran';</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (category === 'Uang Supervisi') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiInputs.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>calculateSupervisiTotal();</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else if (category) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.standardInputs.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if(category === 'Lainnya') {</p>
<p class="p1"><span class="Apple-converted-space">                         </span>DOMElements.standardDescriptionLabel.textContent = '2. Ketik Kategori &amp; Keterangan';</p>
<p class="p1"><span class="Apple-converted-space">                         </span>DOMElements.standardDescription.placeholder = 'Contoh: Biaya Cetak Dokumen Proyek';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const resetForm = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.expenseForm.reset();</p>
<p class="p1"><span class="Apple-converted-space">                </span>state.editingId = null;</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.formTitle.textContent = 'Tambah Rincian Pengajuan';</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.addExpenseBtn.innerHTML = '&lt;i class="fas fa-plus mr-2"&gt;&lt;/i&gt;Tambah';</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.cancelEditBtn.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>updateFormUI('');</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>Object.keys(DOMElements.projectInfoFields).forEach(key =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const field = DOMElements.projectInfoFields[key];</p>
<p class="p1"><span class="Apple-converted-space">                </span>if(field &amp;&amp; key !== 'ppuNumber') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>field.addEventListener('blur', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>state.projectInfo[key] = (key === 'projectDate' || key === 'proposalDate') ? parseDateFromInput(e.target.value) || '' : e.target.value;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>[DOMElements.standardAmount, DOMElements.supervisiRateWork, DOMElements.supervisiRateHoliday].forEach(input =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>input.addEventListener('input', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const value = parseCurrency(e.target.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>e.target.value = formatForInputCurrency(value);</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>[DOMElements.supervisiStartDate, DOMElements.supervisiEndDate, DOMElements.supervisiRateWork, DOMElements.supervisiRateHoliday].forEach(el =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>el.addEventListener('input', calculateSupervisiTotal);</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.expenseCategoryInput.addEventListener('change', (e) =&gt; updateFormUI(e.target.value));</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.expenseForm.addEventListener('submit', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">                </span>const category = DOMElements.expenseCategoryInput.value;</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!category) return showModal('Input Kurang', 'Mohon pilih kategori pengajuan.');</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (state.editingId) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>state.expenses = state.expenses.filter(exp =&gt; (exp.groupId || exp.id) !== state.editingId);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (category === 'Uang Supervisi') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const name = DOMElements.supervisiName.value.trim();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const startDate = parseDateFromInput(DOMElements.supervisiStartDate.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const endDate = parseDateFromInput(DOMElements.supervisiEndDate.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (!name || !startDate || !endDate) return showModal('Input Tidak Lengkap', 'Mohon lengkapi Nama Supervisi dan Periode Tanggal.');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const { workCount, holidayCount, holidayDetails } = getDayCounts(new Date(`${startDate}T00:00:00`), new Date(`${endDate}T00:00:00`));</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const rateWork = parseCurrency(DOMElements.supervisiRateWork.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const rateHoliday = parseCurrency(DOMElements.supervisiRateHoliday.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const totalAmount = (workCount * rateWork) + (holidayCount * rateHoliday);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (totalAmount &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const groupId = state.editingId || `group-${Date.now()}`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const additionalDesc = DOMElements.supervisiDescription.value.trim();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const description = `Uang Supervisi ${name} (Kerja: ${workCount} hr, Libur: ${holidayCount} hr)${additionalDesc ? ` - ${additionalDesc}` : ''}`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>state.expenses.push({ id: `exp-${Date.now()}`, groupId, isPeriod: true, date: startDate, endDate, description, amount: totalAmount, category: 'Uang Supervisi', details: { name, description: additionalDesc, rateWork, rateHoliday, workCount, holidayCount, holidayDetails } });</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const description = DOMElements.standardDescription.value.trim();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const amount = parseCurrency(DOMElements.standardAmount.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const date = parseDateFromInput(DOMElements.projectInfoFields.projectDate.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (!date || !description || amount &lt;= 0) return showModal('Input Tidak Lengkap', 'Mohon lengkapi "Tanggal pengeluaran uang", Keterangan, dan Jumlah.');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>state.expenses.push({ id: state.editingId || `exp-${Date.now()}`, isPeriod: false, date, description, amount, category: category === 'Lainnya' ? description.split(' ')[0] : category });</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>renderAll();</p>
<p class="p1"><span class="Apple-converted-space">                </span>resetForm();</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.cancelEditBtn.addEventListener('click', resetForm);</p>
<p class="p1"><span class="Apple-converted-space">            </span>window.ppu_handleEdit = (id) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const expenseToEdit = state.expenses.find(exp =&gt; exp.id === id || exp.groupId === id);</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!expenseToEdit) return;</p>
<p class="p1"><span class="Apple-converted-space">                </span>state.editingId = id;</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (expenseToEdit.groupId) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const { details } = expenseToEdit;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.expenseCategoryInput.value = 'Uang Supervisi';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>updateFormUI('Uang Supervisi');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiName.value = details.name;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiStartDate.value = formatDateForInput(expenseToEdit.date);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiEndDate.value = formatDateForInput(expenseToEdit.endDate);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiDescription.value = details.description;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiRateWork.value = formatForInputCurrency(details.rateWork);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiRateHoliday.value = formatForInputCurrency(details.rateHoliday);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>calculateSupervisiTotal();</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                     </span>const isStandardCat = Array.from(DOMElements.expenseCategoryInput.options).some(opt =&gt; opt.value === expenseToEdit.category);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.expenseCategoryInput.value = isStandardCat ? expenseToEdit.category : 'Lainnya';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>updateFormUI(DOMElements.expenseCategoryInput.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.standardDescription.value = expenseToEdit.description;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.standardAmount.value = formatForInputCurrency(expenseToEdit.amount);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.formTitle.textContent = 'Edit Rincian Pengajuan';</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.addExpenseBtn.innerHTML = '&lt;i class="fas fa-save mr-2"&gt;&lt;/i&gt;Simpan Perubahan';</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.cancelEditBtn.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.expenseForm.scrollIntoView({ behavior: 'smooth' });</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>window.ppu_handleDelete = (id) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const expenseToDelete = state.expenses.find(exp =&gt; exp.id === id || exp.groupId === id);</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!expenseToDelete) return;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const confirmMessage = expenseToDelete.groupId ? 'Ini akan menghapus seluruh entri supervisi terkait. Yakin?' : 'Apakah Anda yakin ingin menghapus rincian ini?';</p>
<p class="p1"><span class="Apple-converted-space">                </span>showModal('Konfirmasi Hapus', confirmMessage, 'confirm', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>state.expenses = state.expenses.filter(exp =&gt; (exp.groupId || exp.id) !== id);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (state.editingId === id) resetForm();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>renderAll();</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.previewProposalBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const totalProposal = state.expenses.reduce((sum, exp) =&gt; sum + exp.amount, 0);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const logoUrl = "https://raw.githubusercontent.com/krisandi89/rekap/main/LOGO%20MULTIBANGUN%20(Primary).png";</p>
<p class="p1"><span class="Apple-converted-space">                </span>const sortedExpenses = [...state.expenses].sort((a, b) =&gt; new Date(a.date) - new Date(b.date));</p>
<p class="p1"><span class="Apple-converted-space">                </span>const expenseRowsHTML = sortedExpenses.map((exp, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>let finalDescription;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (exp.category === 'Uang Supervisi' &amp;&amp; exp.details) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const { name, workCount, holidayCount, description: additionalDesc, holidayDetails } = exp.details;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const period = `periode ${formatDateForReport(exp.date)} - ${formatDateForReport(exp.endDate)}`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const counts = `(${workCount} hari kerja, ${holidayCount} hari libur)`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>finalDescription = `Uang Supervisi ${name} ${period} ${counts}`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (additionalDesc) finalDescription += ` - ${additionalDesc}`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (holidayDetails?.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>const holidayList = holidayDetails.map(h =&gt; `&lt;li&gt;${formatDateForReport(h.date, {day: 'numeric', month: 'short'})}: ${h.name}&lt;/li&gt;`).join('');</p>
<p class="p1"><span class="Apple-converted-space">                            </span>finalDescription += `&lt;br/&gt;&lt;div style="font-size: 10px; color: #555; padding-left: 10px;"&gt;Ket. Libur:&lt;ul style="margin: 0; padding-left: 15px;"&gt;${holidayList}&lt;/ul&gt;&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>finalDescription = exp.description;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return `&lt;tr&gt;&lt;td class="text-center"&gt;${index + 1}&lt;/td&gt;&lt;td&gt;${finalDescription}&lt;/td&gt;&lt;td class="text-right"&gt;${formatToCurrency(exp.amount)}&lt;/td&gt;&lt;/tr&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}).join('');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const proposalDateFormatted = state.projectInfo.proposalDate ? formatDateForReport(state.projectInfo.proposalDate, { day: '2-digit', month: 'long', year: 'numeric' }) : new Date().toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' });</p>
<p class="p1"><span class="Apple-converted-space">                </span>const reportHTML = `&lt;!DOCTYPE html&gt;&lt;html lang="id"&gt;&lt;head&gt;&lt;title&gt;Proposal Pengajuan&lt;/title&gt;&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;\/script&gt;&lt;link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"&gt;&lt;style&gt;@page{size: A4; margin: 0;} body{font-family: 'Inter', sans-serif; margin:0;} .a4-container{width:210mm;min-height:297mm;margin:2rem auto;padding:1.5rem;box-shadow:0 0 10px rgba(0,0,0,0.1);background:white;border:1px solid #ddd;} table,th,td{border:1px solid black;border-collapse:collapse;} th,td{padding:8px;text-align:left;vertical-align:top;} .no-border-table,.no-border-table tr,.no-border-table td{border:none;padding:2px 4px;} .report-header{position:relative;text-align:center;padding-bottom:1rem;margin-bottom:1rem;border-bottom:2px solid black;} .report-header img{position:absolute;top:50%;transform:translateY(-50%);left:0;height:28px;} .report-header h1{margin:0;padding:0;line-height:28px;} @media print{body{-webkit-print-color-adjust:exact;print-color-adjust:exact;} .no-print{display:none !important;} .a4-container{margin:0;box-shadow:none;border:none;width:100%;min-height:0;padding:1.5cm;}}&lt;/style&gt;&lt;/head&gt;&lt;body class="bg-gray-200"&gt;&lt;div class="a4-container"&gt;&lt;header class="report-header"&gt;&lt;img src="${logoUrl}" alt="Logo"&gt;&lt;h1 class="text-xl font-bold uppercase"&gt;Pengajuan Pengeluaran Uang&lt;/h1&gt;&lt;/header&gt;&lt;section class="mb-6 text-sm"&gt;&lt;table class="w-full no-border-table"&gt;&lt;tr&gt;&lt;td class="w-1/4 font-semibold"&gt;Nomor PPU&lt;/td&gt;&lt;td&gt;: ${formatTextForPreview(state.projectInfo.ppuNumber)}&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="w-1/4 font-semibold"&gt;Proyek&lt;/td&gt;&lt;td&gt;: ${formatTextForPreview(state.projectInfo.name)}&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="w-1/4 font-semibold"&gt;Lokasi&lt;/td&gt;&lt;td&gt;: ${formatTextForPreview(state.projectInfo.location)}&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="w-1/4 font-semibold"&gt;Tanggal Pengeluaran Uang&lt;/td&gt;&lt;td&gt;: ${formatDateForReport(state.projectInfo.projectDate, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) || '-'}&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="w-1/4 font-semibold"&gt;Kegiatan&lt;/td&gt;&lt;td&gt;: ${formatTextForPreview(state.projectInfo.activity)}&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="w-1/4 font-semibold"&gt;Personil&lt;/td&gt;&lt;td&gt;: ${formatTextForPreview(state.projectInfo.personnel)}&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/section&gt;&lt;section&gt;&lt;table class="w-full text-sm"&gt;&lt;thead class="bg-gray-200"&gt;&lt;tr class="font-semibold text-center"&gt;&lt;th class="w-12"&gt;No.&lt;/th&gt;&lt;th&gt;Uraian&lt;/th&gt;&lt;th class="w-40"&gt;Jumlah (Rp)&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;${expenseRowsHTML || '&lt;tr&gt;&lt;td colspan="3" class="text-center p-8 text-gray-500"&gt;Tidak ada data.&lt;/td&gt;&lt;/tr&gt;'}&lt;/tbody&gt;&lt;tfoot&gt;&lt;tr class="font-semibold bg-gray-200"&gt;&lt;td colspan="2" class="text-center"&gt;Total Diajukan&lt;/td&gt;&lt;td class="text-right font-bold"&gt;${formatToCurrency(totalProposal)}&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;&lt;/table&gt;&lt;/section&gt;&lt;footer class="mt-16 flex justify-end text-sm"&gt;&lt;div class="text-center"&gt;&lt;p&gt;${formatTextForPreview(state.projectInfo.applicantLocation)}, ${proposalDateFormatted}&lt;/p&gt;&lt;p class="mb-16"&gt;Yang mengajukan,&lt;/p&gt;&lt;p class="font-semibold underline"&gt;${formatTextForPreview(state.projectInfo.applicant)}&lt;/p&gt;&lt;/div&gt;&lt;/footer&gt;&lt;/div&gt;&lt;div class="max-w-5xl mx-auto text-center p-4 no-print"&gt;&lt;button onclick="window.print()" class="btn btn-primary"&gt;&lt;i class="fas fa-print mr-2"&gt;&lt;/i&gt;Cetak&lt;/button&gt;&lt;button onclick="window.close()" class="btn btn-secondary"&gt;&lt;i class="fas fa-times mr-2"&gt;&lt;/i&gt;Tutup&lt;/button&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const reportWindow = window.open('', '_blank');</p>
<p class="p1"><span class="Apple-converted-space">                </span>reportWindow.document.write(reportHTML);</p>
<p class="p1"><span class="Apple-converted-space">                </span>reportWindow.document.close();</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>const flatpickrConfig = { dateFormat: "d/m/Y", locale: "id" };</p>
<p class="p1"><span class="Apple-converted-space">            </span>flatpickr(`#${prefix}project-date`, flatpickrConfig);</p>
<p class="p1"><span class="Apple-converted-space">            </span>flatpickr(`#${prefix}proposal-date`, flatpickrConfig);</p>
<p class="p1"><span class="Apple-converted-space">            </span>flatpickr(`#${prefix}supervisi-start-date`, flatpickrConfig);</p>
<p class="p1"><span class="Apple-converted-space">            </span>flatpickr(`#${prefix}supervisi-end-date`, flatpickrConfig);</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>state.projectInfo.ppuNumber = generatePPUNumber();</p>
<p class="p1"><span class="Apple-converted-space">            </span>renderProjectInfo();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// --- REKAP APP SCRIPT ---</p>
<p class="p1"><span class="Apple-converted-space">        </span>function initRekapApp() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const prefix = 'rekap-';</p>
<p class="p1"><span class="Apple-converted-space">            </span>const DOMElements = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>fetchPPUNumberInput: document.getElementById(`${prefix}fetch-ppu-number`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>fetchPPUBtn: document.getElementById(`${prefix}fetch-ppu-btn`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>saveBtn: document.getElementById(`${prefix}save-btn`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>projectInfoFields: { name: document.getElementById(`${prefix}project-name`), location: document.getElementById(`${prefix}project-location`), personnel: document.getElementById(`${prefix}project-personnel`), activity: document.getElementById(`${prefix}project-activity`), applicant: document.getElementById(`${prefix}project-applicant`), applicantLocation: document.getElementById(`${prefix}project-applicant-location`) },</p>
<p class="p1"><span class="Apple-converted-space">                </span>initialBudgetInput: document.getElementById(`${prefix}initial-budget`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>budgetDateInput: document.getElementById(`${prefix}budget-date`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>setBudgetBtn: document.getElementById(`${prefix}set-budget-btn`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>summaryBudget: document.getElementById(`${prefix}summary-budget`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>summaryExpenses: document.getElementById(`${prefix}summary-expenses`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>summaryBalance: document.getElementById(`${prefix}summary-balance`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>expenseForm: document.getElementById(`${prefix}expense-form`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>formTitle: document.getElementById(`${prefix}form-title`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>expenseIdInput: document.getElementById(`${prefix}expense-id`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>expenseCategoryInput: document.getElementById(`${prefix}expense-category`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>addExpenseBtn: document.getElementById(`${prefix}add-expense-btn`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>cancelEditBtn: document.getElementById(`${prefix}cancel-edit-btn`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>expenseTableBody: document.getElementById(`${prefix}expense-table-body`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>noDataMessage: document.getElementById(`${prefix}no-data-message`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>previewReportBtn: document.getElementById(`${prefix}preview-report-btn`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>standardInputs: document.getElementById(`${prefix}standard-inputs`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiInputs: document.getElementById(`${prefix}supervisi-inputs`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>standardDate: document.getElementById(`${prefix}standard-date`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>standardDescription: document.getElementById(`${prefix}standard-description`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>standardDescriptionLabel: document.getElementById(`${prefix}standard-description-label`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>standardAmount: document.getElementById(`${prefix}standard-amount`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiName: document.getElementById(`${prefix}supervisi-name`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiStartDate: document.getElementById(`${prefix}supervisi-start-date`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiEndDate: document.getElementById(`${prefix}supervisi-end-date`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiRateWork: document.getElementById(`${prefix}supervisi-rate-work`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiRateHoliday: document.getElementById(`${prefix}supervisi-rate-holiday`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiDayCountWork: document.getElementById(`${prefix}supervisi-day-count-work`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiDayCountHoliday: document.getElementById(`${prefix}supervisi-day-count-holiday`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiDescription: document.getElementById(`${prefix}supervisi-description`),</p>
<p class="p1"><span class="Apple-converted-space">                </span>supervisiTotalAmount: document.getElementById(`${prefix}supervisi-total-amount`)</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>let state = { projectInfo: {}, budget: { amount: 0, date: '' }, expenses: [], editingId: null };</p>
<p class="p1"><span class="Apple-converted-space">            </span>let expenseDistributionChart = null;</p>
<p class="p1"><span class="Apple-converted-space">            </span>let monthlyExpenseChart = null;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// FUNGSI BARU: Mengambil data dari Vercel</p>
<p class="p1"><span class="Apple-converted-space">            </span>const fetchPPUData = async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const ppuNumber = DOMElements.fetchPPUNumberInput.value.trim();</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!ppuNumber) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showModal('Input Kosong', 'Silakan masukkan Nomor PPU yang valid.');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const originalBtnHtml = DOMElements.fetchPPUBtn.innerHTML;</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.fetchPPUBtn.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.fetchPPUBtn.innerHTML = `&lt;i class="fas fa-spinner fa-spin mr-2"&gt;&lt;/i&gt;Mencari...`;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const response = await fetch(`/api/ambilPPU?ppuNumber=${ppuNumber}`);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const result = await response.json();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (response.ok &amp;&amp; result.success) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const { projectInfo, expenses } = result.data;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const totalProposal = expenses.reduce((sum, exp) =&gt; sum + exp.amount, 0);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>state.projectInfo = projectInfo;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>state.budget.amount = totalProposal;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>state.budget.date = projectInfo.proposalDate || new Date().toISOString().slice(0, 10);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>state.expenses = expenses;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                        </span>renderAll();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>showNotification('Data PPU berhasil ditarik!', 'success');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>throw new Error(result.message || 'Data tidak ditemukan.');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.error('Error fetching PPU data:', error);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>showModal('Gagal Mengambil Data', error.message);</p>
<p class="p1"><span class="Apple-converted-space">                </span>} finally {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.fetchPPUBtn.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.fetchPPUBtn.innerHTML = originalBtnHtml;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.fetchPPUBtn.addEventListener('click', fetchPPUData);</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Tombol simpan rekap dinonaktifkan untuk saat ini</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.saveBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>showNotification('Fitur simpan rekap belum diaktifkan.', 'info');</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>window.initRekapCharts = function() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const chartContainer = document.getElementById('rekap-charts-container');</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (state.expenses.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>chartContainer.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (!document.getElementById('expense-distribution-chart')) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>chartContainer.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="card p-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;h3 class="text-lg font-semibold text-gray-700 mb-4"&gt;Distribusi Pengeluaran&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;canvas id="expense-distribution-chart" height="300"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;div class="card p-6"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;h3 class="text-lg font-semibold text-gray-700 mb-4"&gt;Tren Pengeluaran Bulanan&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                </span>&lt;canvas id="monthly-expense-chart" height="300"&gt;&lt;/canvas&gt;</p>
<p class="p1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>initExpenseDistributionChart();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>initMonthlyExpenseChart();</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>chartContainer.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>function initExpenseDistributionChart() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (expenseDistributionChart) expenseDistributionChart.destroy();</p>
<p class="p1"><span class="Apple-converted-space">                </span>const ctx = document.getElementById('expense-distribution-chart').getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const categoryTotals = state.expenses.reduce((acc, exp) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>acc[exp.category] = (acc[exp.category] || 0) + exp.amount;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return acc;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}, {});</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>expenseDistributionChart = new Chart(ctx, {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>type: 'doughnut',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>data: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>labels: Object.keys(categoryTotals),</p>
<p class="p1"><span class="Apple-converted-space">                        </span>datasets: [{</p>
<p class="p1"><span class="Apple-converted-space">                            </span>data: Object.values(categoryTotals),</p>
<p class="p1"><span class="Apple-converted-space">                            </span>backgroundColor: ['#4f46e5', '#0ea5e9', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6']</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}]</p>
<p class="p1"><span class="Apple-converted-space">                    </span>},</p>
<p class="p1"><span class="Apple-converted-space">                    </span>options: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>responsive: true, maintainAspectRatio: false,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>plugins: {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>legend: { position: 'right' },</p>
<p class="p1"><span class="Apple-converted-space">                            </span>tooltip: {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>callbacks: {</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>label: (context) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>const total = context.dataset.data.reduce((a, b) =&gt; a + b, 0);</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>const percentage = total &gt; 0 ? Math.round((context.parsed / total) * 100) : 0;</p>
<p class="p1"><span class="Apple-converted-space">                                        </span>return `${context.label}: ${formatToCurrency(context.parsed)} (${percentage}%)`;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                            </span>}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>function initMonthlyExpenseChart() {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (monthlyExpenseChart) monthlyExpenseChart.destroy();</p>
<p class="p1"><span class="Apple-converted-space">                </span>const ctx = document.getElementById('monthly-expense-chart').getContext('2d');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const monthlyData = state.expenses.reduce((acc, exp) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const monthKey = exp.date.substring(0, 7); // YYYY-MM</p>
<p class="p1"><span class="Apple-converted-space">                    </span>acc[monthKey] = (acc[monthKey] || 0) + exp.amount;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return acc;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}, {});</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const sortedMonths = Object.keys(monthlyData).sort();</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>monthlyExpenseChart = new Chart(ctx, {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>type: 'line',</p>
<p class="p1"><span class="Apple-converted-space">                    </span>data: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>labels: sortedMonths.map(m =&gt; new Date(m + '-02').toLocaleDateString('id-ID', { month: 'short', year: '2-digit' })),</p>
<p class="p1"><span class="Apple-converted-space">                        </span>datasets: [{</p>
<p class="p1"><span class="Apple-converted-space">                            </span>label: 'Pengeluaran',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>data: sortedMonths.map(m =&gt; monthlyData[m]),</p>
<p class="p1"><span class="Apple-converted-space">                            </span>borderColor: '#4f46e5', backgroundColor: 'rgba(79, 70, 229, 0.1)',</p>
<p class="p1"><span class="Apple-converted-space">                            </span>borderWidth: 3, pointBackgroundColor: '#4f46e5', fill: true, tension: 0.3</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}]</p>
<p class="p1"><span class="Apple-converted-space">                    </span>},</p>
<p class="p1"><span class="Apple-converted-space">                    </span>options: {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false },</p>
<p class="p1"><span class="Apple-converted-space">                        </span>plugins: { tooltip: { callbacks: { label: (c) =&gt; `Total: ${formatToCurrency(c.parsed.y)}` } } },</p>
<p class="p1"><span class="Apple-converted-space">                        </span>scales: { y: { ticks: { callback: (v) =&gt; formatToCurrency(v) } } }</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const calculateSupervisiTotal = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const startDateStr = parseDateFromInput(DOMElements.supervisiStartDate.value);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const endDateStr = parseDateFromInput(DOMElements.supervisiEndDate.value);</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!startDateStr || !endDateStr) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiDayCountWork.value = `0 hr kerja`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiDayCountHoliday.value = `0 hr libur`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiTotalAmount.value = '';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>const startDate = new Date(`${startDateStr}T00:00:00`);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const endDate = new Date(`${endDateStr}T00:00:00`);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const { workCount, holidayCount } = getDayCounts(startDate, endDate);</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.supervisiDayCountWork.value = `${workCount} hr kerja`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.supervisiDayCountHoliday.value = `${holidayCount} hr libur`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const rateWork = parseCurrency(DOMElements.supervisiRateWork.value);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const rateHoliday = parseCurrency(DOMElements.supervisiRateHoliday.value);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const total = (workCount * rateWork) + (holidayCount * rateHoliday);</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.supervisiTotalAmount.value = formatForInputCurrency(total);</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const renderSummary = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const totalExpenses = state.expenses.reduce((sum, exp) =&gt; sum + exp.amount, 0);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const balance = state.budget.amount - totalExpenses;</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.summaryBudget.textContent = formatToCurrency(state.budget.amount);</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.summaryExpenses.textContent = formatToCurrency(totalExpenses);</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.summaryBalance.textContent = formatToCurrency(balance);</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.summaryBalance.classList.toggle('text-red-600', balance &lt; 0);</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.summaryBalance.classList.toggle('text-green-600', balance &gt;= 0);</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const renderTable = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                 </span>DOMElements.expenseTableBody.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">                </span>const hasExpenses = state.expenses.length &gt; 0;</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.noDataMessage.style.display = hasExpenses ? 'none' : 'table-row';</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (hasExpenses) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>[...state.expenses].sort((a, b) =&gt; new Date(b.date) - new Date(a.date)).forEach(exp =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const row = DOMElements.expenseTableBody.insertRow();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>row.className = 'border-b border-gray-200 hover:bg-gray-50';</p>
<p class="p1"><span class="Apple-converted-space">                        </span>row.insertCell().textContent = exp.isPeriod ? `${formatDateForReport(exp.date)} - ${formatDateForReport(exp.endDate)}` : formatDateForReport(exp.date);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>row.cells[0].className = 'p-3 align-top';</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const descCell = row.insertCell();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>descCell.className = 'p-3 align-top';</p>
<p class="p1"><span class="Apple-converted-space">                        </span>let descriptionHtml = exp.description;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (exp.category === 'Uang Supervisi' &amp;&amp; exp.details?.holidayDetails?.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>const holidayList = exp.details.holidayDetails.map(h =&gt; `&lt;li&gt;${formatDateForReport(h.date, {day: 'numeric', month: 'short'})}: ${h.name}&lt;/li&gt;`).join('');</p>
<p class="p1"><span class="Apple-converted-space">                            </span>descriptionHtml += `&lt;ul class="text-xs text-gray-500 mt-1 pl-4 list-disc"&gt;Ket. Libur:${holidayList}&lt;/ul&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>descCell.innerHTML = descriptionHtml;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>row.insertCell().innerHTML = `&lt;span class="px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800 whitespace-nowrap"&gt;${exp.category}&lt;/span&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>row.insertCell().textContent = formatToCurrency(exp.amount);</p>
<p class="p1"><span class="Apple-converted-space">                        </span>row.cells[3].className = 'p-3 align-top text-right font-semibold';</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const actionCell = row.insertCell();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>actionCell.className = 'p-3 align-top text-center';</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const actionId = exp.groupId || exp.id;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>actionCell.innerHTML = `&lt;button onclick="window.rekap_handleEdit('${actionId}')" class="text-blue-500 hover:text-blue-700 mr-2" title="Edit"&gt;&lt;i class="fas fa-pencil-alt"&gt;&lt;/i&gt;&lt;/button&gt;&lt;button onclick="window.rekap_handleDelete('${actionId}')" class="text-red-500 hover:text-red-700" title="Hapus"&gt;&lt;i class="fas fa-trash-alt"&gt;&lt;/i&gt;&lt;/button&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const renderProjectInfo = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>for (const key in DOMElements.projectInfoFields) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const field = DOMElements.projectInfoFields[key];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if(field) field.value = state.projectInfo[key] || '';</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const renderBudget = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const hasBudget = state.budget.amount &gt; 0;</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.initialBudgetInput.value = formatForInputCurrency(state.budget.amount);</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.budgetDateInput.value = formatDateForInput(state.budget.date);</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.initialBudgetInput.disabled = hasBudget;</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.budgetDateInput.disabled = hasBudget;</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.setBudgetBtn.innerHTML = hasBudget ? '&lt;i class="fas fa-edit mr-2"&gt;&lt;/i&gt;Ubah Budget' : '&lt;i class="fas fa-save mr-2"&gt;&lt;/i&gt;Atur Budget';</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const renderAll = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>renderProjectInfo();</p>
<p class="p1"><span class="Apple-converted-space">                </span>renderBudget();</p>
<p class="p1"><span class="Apple-converted-space">                </span>renderSummary();</p>
<p class="p1"><span class="Apple-converted-space">                </span>renderTable();</p>
<p class="p1"><span class="Apple-converted-space">                </span>initRekapCharts();</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const updateFormUI = (category) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.standardInputs.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.supervisiInputs.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.standardDescriptionLabel.textContent = '3. Keterangan';</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.standardDescription.placeholder = 'Detail pengeluaran';</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (category === 'Uang Supervisi') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiInputs.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>calculateSupervisiTotal();</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else if (category) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.standardInputs.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if(category === 'Lainnya') {</p>
<p class="p1"><span class="Apple-converted-space">                         </span>DOMElements.standardDescriptionLabel.textContent = '3. Ketik Kategori &amp; Keterangan';</p>
<p class="p1"><span class="Apple-converted-space">                         </span>DOMElements.standardDescription.placeholder = 'Contoh: Biaya Cetak Dokumen Proyek';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const resetForm = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.expenseForm.reset();</p>
<p class="p1"><span class="Apple-converted-space">                </span>state.editingId = null;</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.formTitle.textContent = 'Tambah Pengeluaran Baru';</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.addExpenseBtn.innerHTML = '&lt;i class="fas fa-plus mr-2"&gt;&lt;/i&gt;Tambah';</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.cancelEditBtn.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>updateFormUI('');</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.standardDate.value = formatDateForInput(new Date().toISOString().slice(0, 10));</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>Object.keys(DOMElements.projectInfoFields).forEach(key =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const field = DOMElements.projectInfoFields[key];</p>
<p class="p1"><span class="Apple-converted-space">                </span>if(field) field.addEventListener('blur', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>state.projectInfo[key] = e.target.value;</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>[DOMElements.initialBudgetInput, DOMElements.standardAmount, DOMElements.supervisiRateWork, DOMElements.supervisiRateHoliday].forEach(input =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>input.addEventListener('input', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const value = parseCurrency(e.target.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>e.target.value = formatForInputCurrency(value);</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.setBudgetBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (DOMElements.initialBudgetInput.disabled) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.initialBudgetInput.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.budgetDateInput.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.setBudgetBtn.innerHTML = '&lt;i class="fas fa-save mr-2"&gt;&lt;/i&gt;Simpan Perubahan';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.initialBudgetInput.focus();</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const amount = parseCurrency(DOMElements.initialBudgetInput.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const date = parseDateFromInput(DOMElements.budgetDateInput.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (amount &gt; 0 &amp;&amp; date) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>state.budget = { amount, date };</p>
<p class="p1"><span class="Apple-converted-space">                        </span>renderAll();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>showModal('Input Tidak Valid', 'Mohon isi jumlah budget dan tanggal (dd/mm/yyyy) dengan benar.');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>[DOMElements.supervisiStartDate, DOMElements.supervisiEndDate, DOMElements.supervisiRateWork, DOMElements.supervisiRateHoliday].forEach(el =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>el.addEventListener('input', calculateSupervisiTotal);</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.expenseCategoryInput.addEventListener('change', (e) =&gt; updateFormUI(e.target.value));</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.expenseForm.addEventListener('submit', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>e.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">                </span>const category = DOMElements.expenseCategoryInput.value;</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!category) return showModal('Input Kurang', 'Mohon pilih kategori pengeluaran.');</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (state.editingId) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>state.expenses = state.expenses.filter(exp =&gt; (exp.groupId || exp.id) !== state.editingId);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (category === 'Uang Supervisi') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const name = DOMElements.supervisiName.value.trim();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const startDate = parseDateFromInput(DOMElements.supervisiStartDate.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const endDate = parseDateFromInput(DOMElements.supervisiEndDate.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (!name || !startDate || !endDate) return showModal('Input Tidak Lengkap', 'Mohon lengkapi Nama Supervisi dan Periode Tanggal.');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const { workCount, holidayCount, holidayDetails } = getDayCounts(new Date(`${startDate}T00:00:00`), new Date(`${endDate}T00:00:00`));</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const rateWork = parseCurrency(DOMElements.supervisiRateWork.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const rateHoliday = parseCurrency(DOMElements.supervisiRateHoliday.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const totalAmount = (workCount * rateWork) + (holidayCount * rateHoliday);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (totalAmount &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const groupId = state.editingId || `group-${Date.now()}`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const additionalDesc = DOMElements.supervisiDescription.value.trim();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const description = `Uang Supervisi ${name} (Kerja: ${workCount} hr, Libur: ${holidayCount} hr)${additionalDesc ? ` - ${additionalDesc}` : ''}`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>state.expenses.push({ id: `exp-${Date.now()}`, groupId, isPeriod: true, date: startDate, endDate, description, amount: totalAmount, category: 'Uang Supervisi', details: { name, description: additionalDesc, rateWork, rateHoliday, workCount, holidayCount, holidayDetails } });</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const description = DOMElements.standardDescription.value.trim();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const amount = parseCurrency(DOMElements.standardAmount.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const date = parseDateFromInput(DOMElements.standardDate.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (!date || !description || amount &lt;= 0) return showModal('Input Tidak Lengkap', 'Mohon lengkapi Tanggal, Keterangan, dan Jumlah.');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>state.expenses.push({ id: state.editingId || `exp-${Date.now()}`, isPeriod: false, date, description, amount, category: category === 'Lainnya' ? description.split(' ')[0] : category });</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>renderAll();</p>
<p class="p1"><span class="Apple-converted-space">                </span>resetForm();</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.cancelEditBtn.addEventListener('click', resetForm);</p>
<p class="p1"><span class="Apple-converted-space">            </span>window.rekap_handleEdit = (id) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                 </span>const expenseToEdit = state.expenses.find(exp =&gt; exp.id === id || exp.groupId === id);</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!expenseToEdit) return;</p>
<p class="p1"><span class="Apple-converted-space">                </span>state.editingId = id;</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (expenseToEdit.groupId) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const { details } = expenseToEdit;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.expenseCategoryInput.value = 'Uang Supervisi';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>updateFormUI('Uang Supervisi');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiName.value = details.name;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiStartDate.value = formatDateForInput(expenseToEdit.date);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiEndDate.value = formatDateForInput(expenseToEdit.endDate);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiDescription.value = details.description;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiRateWork.value = formatForInputCurrency(details.rateWork);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.supervisiRateHoliday.value = formatForInputCurrency(details.rateHoliday);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>calculateSupervisiTotal();</p>
<p class="p1"><span class="Apple-converted-space">                </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                     </span>const isStandardCat = Array.from(DOMElements.expenseCategoryInput.options).some(opt =&gt; opt.value === expenseToEdit.category);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.expenseCategoryInput.value = isStandardCat ? expenseToEdit.category : 'Lainnya';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>updateFormUI(DOMElements.expenseCategoryInput.value);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.standardDate.value = formatDateForInput(expenseToEdit.date);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.standardDescription.value = expenseToEdit.description;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>DOMElements.standardAmount.value = formatForInputCurrency(expenseToEdit.amount);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.formTitle.textContent = 'Edit Data Pengeluaran';</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.addExpenseBtn.innerHTML = '&lt;i class="fas fa-save mr-2"&gt;&lt;/i&gt;Simpan Perubahan';</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.cancelEditBtn.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">                </span>DOMElements.expenseForm.scrollIntoView({ behavior: 'smooth' });</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>window.rekap_handleDelete = (id) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const expenseToDelete = state.expenses.find(exp =&gt; exp.id === id || exp.groupId === id);</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!expenseToDelete) return;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const confirmMessage = expenseToDelete.groupId ? 'Ini akan menghapus seluruh entri supervisi terkait. Yakin?' : 'Apakah Anda yakin ingin menghapus data ini?';</p>
<p class="p1"><span class="Apple-converted-space">                </span>showModal('Konfirmasi Hapus', confirmMessage, 'confirm', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>state.expenses = state.expenses.filter(exp =&gt; (exp.groupId || exp.id) !== id);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (state.editingId === id) resetForm();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>renderAll();</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>DOMElements.previewReportBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const totalExpenses = state.expenses.reduce((sum, exp) =&gt; sum + exp.amount, 0);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const balance = state.budget.amount - totalExpenses;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const logoUrl = "https://raw.githubusercontent.com/krisandi89/rekap/main/LOGO%20MULTIBANGUN%20(Primary).png";</p>
<p class="p1"><span class="Apple-converted-space">                </span>const sortedExpenses = [...state.expenses].sort((a, b) =&gt; new Date(a.date) - new Date(b.date));</p>
<p class="p1"><span class="Apple-converted-space">                </span>const expenseRowsHTML = sortedExpenses.map((exp, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>let finalDescription;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (exp.category === 'Uang Supervisi' &amp;&amp; exp.details) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const { name, workCount, holidayCount, description: additionalDesc, holidayDetails } = exp.details;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const period = `periode ${formatDateForReport(exp.date)} - ${formatDateForReport(exp.endDate)}`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>const counts = `(${workCount} hari kerja, ${holidayCount} hari libur)`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>finalDescription = `Uang Supervisi ${name} ${period} ${counts}`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (additionalDesc) finalDescription += ` - ${additionalDesc}`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (holidayDetails?.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>const holidayList = holidayDetails.map(h =&gt; `&lt;li&gt;${formatDateForReport(h.date, {day: 'numeric', month: 'short'})}: ${h.name}&lt;/li&gt;`).join('');</p>
<p class="p1"><span class="Apple-converted-space">                            </span>finalDescription += `&lt;br/&gt;&lt;div style="font-size: 10px; color: #555; padding-left: 10px;"&gt;Ket. Libur:&lt;ul style="margin: 0; padding-left: 15px;"&gt;${holidayList}&lt;/ul&gt;&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>finalDescription = `${formatDateForReport(exp.date)} ${exp.description}`;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>return `&lt;tr&gt;&lt;td class="text-center"&gt;${index + 2}&lt;/td&gt;&lt;td&gt;${finalDescription}&lt;/td&gt;&lt;td class="text-right"&gt;-&lt;/td&gt;&lt;td class="text-right"&gt;${formatToCurrency(exp.amount)}&lt;/td&gt;&lt;/tr&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}).join('');</p>
<p class="p1"><span class="Apple-converted-space">                </span>const reportHTML = `&lt;!DOCTYPE html&gt;&lt;html lang="id"&gt;&lt;head&gt;&lt;title&gt;Laporan Pengeluaran&lt;/title&gt;&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;\/script&gt;&lt;link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"&gt;&lt;style&gt;body{font-family:'Inter',sans-serif;}.a4-container{width:210mm;min-height:297mm;margin:2rem auto;padding:1.5rem;box-shadow:0 0 10px rgba(0,0,0,0.1);background:white;border:1px solid #ddd;}table,th,td{border:1px solid black;border-collapse:collapse;}th,td{padding:8px;text-align:left;vertical-align:top;}.no-border-table,.no-border-table tr,.no-border-table td{border:none;padding:2px 4px;}.report-header{position:relative;text-align:center;padding-bottom:1rem;margin-bottom:1rem;border-bottom:2px solid black;}.report-header img{position:absolute;top:50%;transform:translateY(-50%);left:0;height:28px;}.report-header h1{margin:0;padding:0;line-height:28px;}@media print{body{-webkit-print-color-adjust:exact;print-color-adjust:exact;margin:0;}.no-print{display:none !important;}.a4-container{margin:0;box-shadow:none;border:none;}}&lt;/style&gt;&lt;/head&gt;&lt;body class="bg-gray-200"&gt;&lt;div class="a4-container"&gt;&lt;header class="report-header"&gt;&lt;img src="${logoUrl}" alt="Logo"&gt;&lt;h1 class="text-xl font-bold uppercase"&gt;Rekapitulasi Pengeluaran Uang&lt;/h1&gt;&lt;/header&gt;&lt;section class="mb-6 text-sm"&gt;&lt;table class="w-full no-border-table"&gt;&lt;tr&gt;&lt;td class="w-1/4 font-semibold"&gt;Proyek&lt;/td&gt;&lt;td&gt;: ${formatTextForPreview(state.projectInfo.name)}&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="w-1/4 font-semibold"&gt;Lokasi&lt;/td&gt;&lt;td&gt;: ${formatTextForPreview(state.projectInfo.location)}&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="w-1/4 font-semibold"&gt;Kegiatan&lt;/td&gt;&lt;td&gt;: ${formatTextForPreview(state.projectInfo.activity)}&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="w-1/4 font-semibold"&gt;Personil&lt;/td&gt;&lt;td&gt;: ${formatTextForPreview(state.projectInfo.personnel)}&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/section&gt;&lt;section&gt;&lt;table class="w-full text-sm"&gt;&lt;thead class="bg-gray-200"&gt;&lt;tr class="font-semibold text-center"&gt;&lt;th class="w-12"&gt;No.&lt;/th&gt;&lt;th&gt;Uraian&lt;/th&gt;&lt;th class="w-40"&gt;Debet&lt;/th&gt;&lt;th class="w-40"&gt;Kredit&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td class="text-center"&gt;1&lt;/td&gt;&lt;td&gt;Uang Diterima Tgl ${formatDateForReport(state.budget.date)}&lt;/td&gt;&lt;td class="text-right"&gt;${formatToCurrency(state.budget.amount)}&lt;/td&gt;&lt;td class="text-right"&gt;-&lt;/td&gt;&lt;/tr&gt;${expenseRowsHTML}&lt;/tbody&gt;&lt;tfoot&gt;&lt;tr class="font-semibold bg-gray-200"&gt;&lt;td colspan="2" class="text-center"&gt;Total&lt;/td&gt;&lt;td class="text-right"&gt;${formatToCurrency(state.budget.amount)}&lt;/td&gt;&lt;td class="text-right"&gt;${formatToCurrency(totalExpenses)}&lt;/td&gt;&lt;/tr&gt;&lt;tr class="font-semibold bg-gray-200"&gt;&lt;td colspan="2" class="text-center"&gt;Balanced&lt;/td&gt;&lt;td class="text-right font-bold" colspan="2"&gt;${formatToCurrency(balance)}&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;&lt;/table&gt;&lt;/section&gt;&lt;footer class="mt-16 flex justify-end text-sm"&gt;&lt;div class="text-center"&gt;&lt;p&gt;${formatTextForPreview(state.projectInfo.applicantLocation)}, ${new Date().toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' })}&lt;/p&gt;&lt;p class="mb-16"&gt;Yang mengajukan,&lt;/p&gt;&lt;p class="font-semibold underline"&gt;${formatTextForPreview(state.projectInfo.applicant)}&lt;/p&gt;&lt;/div&gt;&lt;/footer&gt;&lt;/div&gt;&lt;div class="max-w-5xl mx-auto text-center p-4 no-print"&gt;&lt;button onclick="window.print()" class="btn btn-primary"&gt;&lt;i class="fas fa-print mr-2"&gt;&lt;/i&gt;Cetak&lt;/button&gt;&lt;button onclick="window.close()" class="btn btn-secondary"&gt;&lt;i class="fas fa-times mr-2"&gt;&lt;/i&gt;Tutup&lt;/button&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const reportWindow = window.open('', '_blank');</p>
<p class="p1"><span class="Apple-converted-space">                </span>reportWindow.document.write(reportHTML);</p>
<p class="p1"><span class="Apple-converted-space">                </span>reportWindow.document.close();</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">            </span>const flatpickrConfig = { dateFormat: "d/m/Y", locale: "id" };</p>
<p class="p1"><span class="Apple-converted-space">            </span>flatpickr(`#${prefix}budget-date`, flatpickrConfig);</p>
<p class="p1"><span class="Apple-converted-space">            </span>flatpickr(`#${prefix}standard-date`, flatpickrConfig);</p>
<p class="p1"><span class="Apple-converted-space">            </span>flatpickr(`#${prefix}supervisi-start-date`, flatpickrConfig);</p>
<p class="p1"><span class="Apple-converted-space">            </span>flatpickr(`#${prefix}supervisi-end-date`, flatpickrConfig);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><span class="Apple-converted-space">        </span></p>
<p class="p1"><span class="Apple-converted-space">        </span>// --- LAPORAN HARIAN APP SCRIPT ---</p>
<p class="p1"><span class="Apple-converted-space">        </span>function initLaporanApp() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const prefix = 'laporan-';</p>
<p class="p1"><span class="Apple-converted-space">            </span>const saveBtn = document.getElementById(`${prefix}save-btn`);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const photoArea = document.getElementById(`${prefix}photoUploadArea`);</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (photoArea) {</p>
<p class="p1"><span class="Apple-converted-space">                 </span>for(let i = 1; i &lt;= 3; i++) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>photoArea.innerHTML += `&lt;div class="space-y-2"&gt;&lt;img id="${prefix}photoPreview${i}" src="https://placehold.co/1600x900/e2e8f0/475569?text=Foto+${i}" class="w-full object-cover rounded-lg aspect-video"&gt;&lt;input type="text" id="${prefix}caption${i}" class="form-input w-full p-2" placeholder="Keterangan Foto ${i}"&gt;&lt;input type="file" accept="image/*" class="hidden" id="${prefix}photoInput${i}" onchange="laporan_previewImage(event, ${i})"&gt;&lt;div class="flex space-x-2"&gt;&lt;label for="${prefix}photoInput${i}" class="w-full text-center cursor-pointer bg-gray-100 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-200"&gt;Pilih Foto&lt;/label&gt;&lt;button onclick="laporan_deleteImage(${i})" class="bg-red-500 text-white px-4 rounded-lg hover:bg-red-600"&gt;&lt;i class="fas fa-trash"&gt;&lt;/i&gt;&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>flatpickr(`#${prefix}reportDate`, { dateFormat: "d/m/Y", locale: "id" });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>saveBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>showNotification('Fitur simpan laporan harian belum diaktifkan.', 'info');</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>window.laporan_previewImage = (event, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const reader = new FileReader();</p>
<p class="p1"><span class="Apple-converted-space">            </span>reader.onload = () =&gt; { document.getElementById(`laporan-photoPreview${index}`).src = reader.result; };</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (event.target.files[0]) reader.readAsDataURL(event.target.files[0]);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>window.laporan_deleteImage = (index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById(`laporan-photoPreview${index}`).src = `https://placehold.co/1600x900/e2e8f0/475569?text=Foto+${index}`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById(`laporan-caption${index}`).value = '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById(`laporan-photoInput${index}`).value = null;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>window.laporan_openPreview = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const formData = {</p>
<p class="p1"><span class="Apple-converted-space">                </span>reportDate: document.getElementById('laporan-reportDate').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>projectId: document.getElementById('laporan-projectId').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>projectLocation: document.getElementById('laporan-projectLocation').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>reporterName: document.getElementById('laporan-reporterName').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>reporterPosition: document.getElementById('laporan-reporterPosition').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>approverName: document.getElementById('laporan-approverName').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>approverPosition: document.getElementById('laporan-approverPosition').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>weather: document.getElementById('laporan-weather').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>mainActivities: document.getElementById('laporan-mainActivities').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>issuesConstraints: document.getElementById('laporan-issuesConstraints').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>nextDayPlan: document.getElementById('laporan-nextDayPlan').value,</p>
<p class="p1"><span class="Apple-converted-space">                </span>photos: Array.from({length: 3}, (_, i) =&gt; ({</p>
<p class="p1"><span class="Apple-converted-space">                    </span>url: document.getElementById(`laporan-photoPreview${i+1}`).src,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>caption: document.getElementById(`laporan-caption${i+1}`).value</p>
<p class="p1"><span class="Apple-converted-space">                </span>})).filter(p =&gt; !p.url.includes('placehold.co'))</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>const activitiesListHtml = formData.mainActivities.split('\n').filter(Boolean).map(activity =&gt; `&lt;li&gt;${activity}&lt;/li&gt;`).join('');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const photosGridHtml = formData.photos.map(photo =&gt; `&lt;div class="photo-item"&gt;&lt;img src="${photo.url}" alt="${photo.caption}"&gt;&lt;p class="text-xs text-center text-gray-700 mt-1 font-medium"&gt;${photo.caption || '&amp;nbsp;'}&lt;/p&gt;&lt;/div&gt;`).join('');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const formattedDate = ((dateStr) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!dateStr) return '-';</p>
<p class="p1"><span class="Apple-converted-space">                </span>const parts = dateStr.split('/');</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (parts.length !== 3) return dateStr;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const dateObj = new Date(parts[2], parts[1] - 1, parts[0]);</p>
<p class="p1"><span class="Apple-converted-space">                </span>return dateObj.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });</p>
<p class="p1"><span class="Apple-converted-space">            </span>})(formData.reportDate);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const reportHTML = `&lt;!DOCTYPE html&gt;&lt;html lang="id"&gt;&lt;head&gt;&lt;title&gt;Preview Laporan Harian&lt;/title&gt;&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;\/script&gt;&lt;link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"&gt;&lt;style&gt;body{font-family:'Inter',sans-serif;background-color:#e5e7eb;display:flex;justify-content:center;padding:2rem;} .no-print{display:block;} @page{size:A4 landscape;margin:10mm;} .report-container{width:277mm;height:190mm;display:flex;border:1px solid #ccc;background-color:white;box-shadow:0 0 20px rgba(0,0,0,0.15);overflow:hidden;} .main-content{flex:2;padding:20px;border-right:1px solid #ddd;display:flex;flex-direction:column;} .photo-sidebar{flex:1;padding:20px;display:flex;flex-direction:column;background-color:#f9fafb;justify-content:flex-start;gap:15px;} .photo-item img{aspect-ratio:16 / 9;width:100%;object-fit:cover;border-radius:8px;border:1px solid #ddd;} .section-title{font-weight:700;color:#1f2937;border-bottom:2px solid #3b82f6;padding-bottom:5px;margin-top:1rem;margin-bottom:8px;font-size:0.9rem;text-transform:uppercase;} .info-table{width:100%;border-collapse:collapse;} .info-table td{padding:3px 0;font-size:0.85rem;} .content-text,.list-disc{font-size:0.85rem;line-height:1.5;} .signature-area{margin-top:auto;} @media print{body{margin:0;padding:0;background-color:white;} .no-print{display:none;} .report-container{border:none;box-shadow:none;width:100%;height:100%;page-break-after:always;}}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;div class="flex flex-col items-center"&gt;&lt;div class="report-container"&gt;&lt;div class="main-content"&gt;&lt;div class="flex justify-between items-center pb-3 mb-3 border-b-4 border-gray-800"&gt;&lt;img src="https://raw.githubusercontent.com/krisandi89/rekap/main/LOGO%20MULTIBANGUN%20(Primary).png" alt="Logo" class="h-7"&gt;&lt;div class="text-center"&gt;&lt;h1 class="text-xl font-bold uppercase"&gt;Laporan Harian Proyek&lt;/h1&gt;&lt;/div&gt;&lt;div class="w-16"&gt;&lt;/div&gt;&lt;/div&gt;&lt;table class="info-table mb-3"&gt;&lt;tr&gt;&lt;td class="w-1/4 font-semibold"&gt;Tanggal Laporan&lt;/td&gt;&lt;td class="w-px px-2"&gt;:&lt;/td&gt;&lt;td&gt;${formattedDate}&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="w-1/4 font-semibold"&gt;Nama Proyek&lt;/td&gt;&lt;td class="w-px px-2"&gt;:&lt;/td&gt;&lt;td&gt;${formData.projectId || '-'}&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="font-semibold"&gt;Lokasi Proyek&lt;/td&gt;&lt;td class="px-2"&gt;:&lt;/td&gt;&lt;td&gt;${formData.projectLocation || '-'}&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td class="font-semibold"&gt;Cuaca&lt;/td&gt;&lt;td class="px-2"&gt;:&lt;/td&gt;&lt;td&gt;${formData.weather || '-'}&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;h3 class="section-title"&gt;Kegiatan Utama Hari Ini&lt;/h3&gt;&lt;ul class="list-disc list-inside content-text pl-4 mb-2"&gt;${activitiesListHtml || '&lt;li&gt;-&lt;/li&gt;'}&lt;/ul&gt;&lt;h3 class="section-title"&gt;Masalah / Kendala&lt;/h3&gt;&lt;p class="content-text mb-2"&gt;${formData.issuesConstraints || 'Tidak ada.'}&lt;/p&gt;&lt;h3 class="section-title"&gt;Rencana Kerja Esok Hari&lt;/h3&gt;&lt;p class="content-text mb-2"&gt;${formData.nextDayPlan || '-'}&lt;/p&gt;&lt;div class="flex justify-around mt-auto text-xs pt-4 signature-area"&gt;&lt;div class="text-center"&gt;&lt;p class="font-semibold"&gt;Dibuat Oleh,&lt;/p&gt;&lt;div class="h-16"&gt;&lt;/div&gt;&lt;p class="font-bold underline"&gt;${formData.reporterName || '....................'}&lt;/p&gt;&lt;p&gt;${formData.reporterPosition || '....................'}&lt;/p&gt;&lt;/div&gt;&lt;div class="text-center"&gt;&lt;p class="font-semibold"&gt;Diketahui Oleh,&lt;/p&gt;&lt;div class="h-16"&gt;&lt;/div&gt;&lt;p class="font-bold underline"&gt;${formData.approverName || '....................'}&lt;/p&gt;&lt;p&gt;${formData.approverPosition || '....................'}&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="photo-sidebar"&gt;&lt;h3 class="text-center font-bold text-base mb-2 border-b-2 border-gray-300 pb-2"&gt;DOKUMENTASI FOTO&lt;/h3&gt;&lt;div class="flex flex-col justify-between flex-grow"&gt;${photosGridHtml || '&lt;div class="text-center text-gray-500 mt-8"&gt;Tidak ada foto.&lt;/div&gt;'}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="no-print text-center mt-6"&gt;&lt;button onclick="window.print()" class="bg-green-600 text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-green-700 transition"&gt;Cetak&lt;/button&gt;&lt;button onclick="window.close()" class="bg-gray-600 text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-gray-700 ml-4 transition"&gt;Tutup&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>const newWindow = window.open('', '_blank');</p>
<p class="p1"><span class="Apple-converted-space">            </span>newWindow.document.write(reportHTML);</p>
<p class="p1"><span class="Apple-converted-space">            </span>newWindow.document.close();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
